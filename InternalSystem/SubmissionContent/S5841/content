11
[p 
	"Mario & Luigi: Partners in Time is the second of five games in the Mario & Luigi RPG series. Mario & Luigi work together with their past selves to exterminate the Shroob aliens. The M&L series is known for the ability to do more damage in battle by hitting action commands as well as the ability to dodge or counterattack every attack in the game, which makes it possible, though difficult in real time, to beat the final boss at an arbitrarily low level. Partners in Time is unique among the other games in the series in that there is no mana; instead, all special attacks are consumable items.
	$LF
]p
[p 
	"This is an improvement over my previous run by 1:28:13.36, or 316697 frames, thanks to glitches found within the past year. Most notably, the requirement of collecting 5 cobalt star shards to enter the final dungeon can now be skipped by clipping through the gate, which alone saves about an hour. This means that the final boss is fought at a very low level (the adults at level 11 and the babies at level 10).
	$LF
]p
[h3 
	" Game objectives
	$LF
]h3
[ul 
	[li 
		" Emulator used: DeSmuME 0.9.9
		$LF
	]li
	[li 
		" Advanced Bus-Level Timing OFF and Dynamic Recompiler OFF
		$LF
	]li
	[li 
		" Aims for fastest time
		$LF
	]li
	[li 
		" Heavy luck manipulation
		$LF
	]li
	[li 
		" Major skip glitch
		$LF
	]li
	[li 
		" Heavy glitch abuse
		$LF
	]li
	[li 
		" Takes damage to save time
		$LF
	]li
	[li 
		" Genre: RPG
		$LF
	]li
]ul
[h3 
	" Encode
	$LF
]h3
[p 
	(youtube|v=7LeP5K4hKQQ)
	$LF
]p
[p 
	"Audio commentary:
	$LF
]p
[p 
	(youtube|v=5sW8m1UQMoA)
	$LF
]p
[h3 
	" Version choice
	$LF
]h3
[p 
	"The US version has increased boss health compared to all other versions. In particular, the final boss has 2700 more HP across both forms in US than in other versions. There are a few glitches that only work on the US 1.0 version, but they do not save nearly enough time to account for the difference in boss health, so I avoided the US version. The title screen in JP is one second faster than EU, but I chose EU so that the encode has English text.
	$LF
]p
[p 
	"Please read http://tasvideos.org/5481S.html for detailed a detailed explanation of battle mechanics, including RNG.
	$LF
]p
[h3 
	" Battle by battle comments
	$LF
]h3
[h4 
	" Baby Bowser
	$LF
]h4
[p 
	"This fight ends after 4 hits, no matter how much damage is done.
	$LF
]p
[h4 
	" Junior Shrooboid
	$LF
]h4
[p 
	"Lucky hits are disabled in this battle, so the only way to speed up this fight is by hitting every counterattack on the first possible frame.
	$LF
]p
[h4 
	" Shrooblets
	$LF
]h4
[p 
	"The POW upgrade I gave Mario after Junior Shrooboid allowed him to kill the shrooblets in 2 jumps. Lucky hits are again disabled here. Luigi's dodging animation is slow so he gets hit.
	$LF
]p
[h4 
	" 3 Shroobs
	$LF
]h4
[p 
	"The shroobs' animation for attacking Luigi is faster, so I take damage in order to manipulate that.
	$LF
]p
[h4 
	" 2 Shroobs
	$LF
]h4
[p 
	"Lucky hits are still disabled. It's faster for both babies to jump on the lower enemy because it decreases the length of the green shells.
	$LF
]p
[h4 
	" Bowser's castle tutorial
	$LF
]h4
[p 
	"This is the first battle in which I manipulate a lucky hit. I wait before the battle to get a good seed. This gives Mario a lucky jump on the boo, allowing me to kill it before it attacked for a second time. If you kill the goomba too early, Kamek will spawn another goomba. So, I delay killing the goomba to save time.
	$LF
]p
[h4 
	" Hammer Bros.
	$LF
]h4
[p 
	"Each bro has 90 HP, for a total of 180 HP. 2 flowers will do 150 total damage, so a lucky hit is needed for a quick battle. I also need to throw as few fireballs as possible, since every fireball takes 7 frames. Therefore I make the most of the lucky hit by attacking only the lower bro during the first flower, and then getting a lucky hit on the top hammer bro on the second flower.
	$LF
]p
[h4 
	" Swiggler
	$LF
]h4
[p 
	"Swiggler has 200 HP, so in order to kill him with 2 flowers, I need to get 2 lucky hits, each doing 100 damage with 50 fireballs. Even with the 2 Dr. Shroobs I have to avoid hitting, this is very managable. The default RNG seed was very good - I just needed to advance RNG once by getting hit.
	$LF
]p
[h4 
	" RC Shroober #1
	$LF
]h4
[p 
	"I switched from the babies to the adults at a particular point along the babies' walk in order to get an RNG seed that would give a lucky hit after some demo RNG manipulation. The RC Shroobers are weak to ice flowers, so each fireball does 3 damage (lucky + critical).
	$LF
]p
[h4 
	" RC Shroober #2
	$LF
]h4
[p 
	"This is similar to the first RC Shroober, except it would have taken too long to manipulate a lucky hit, so each each fireball does 2 damage.
	$LF
]p
[h4 
	" Sunnycide
	$LF
]h4
[p 
	"Sunnycide has 480 HP, so 4 flowers are necessary to kill him. All 4 need to be a lucky hit, and the eggs make it so flowers do less damage to Sunnycide. Therefore, I manipulate Sunnycide to throw as many eggs as possible. I waited about 40 frames before the battle for an RNG seed that made Sunnycide throw 4 eggs and had a quick lucky hit. During the second flower I manipulated Sunnycide to throw 1 egg, which is very rare. When there is 1 egg left, he almost always calls down more eggs, which is slow.
	$LF
]p
[h4 
	" 2 Soul Bubbles and a Shroob Rex
	$LF
]h4
[p 
	"This is the first of three battles I fight to be prepared for the final bosses. Luigi has the EXP badge equipped, which means that any enemy Luigi kills with a bro item will give 20% (1.2x) more experience. In order for this route to work, every enemy that gives experience must be killed by Luigi, or else the adults will not reach level 11. The Soul Bubbles each have 100 HP, so I can kill them each with one lucky flower even though they are aerial enemies. The Shroob Rex has 200 HP, so one lucky flower is not enough, but one non-lucky and one lucky is enough. So, on the first turn, since it's difficult to manipulate a lucky hit as the first hit, I deal enough damage to the Shroob Rex so that I can kill it later with a lucky hit. This bro flower also inflicts burn, which takes away the Shroob Rex's next turn and deals 8 damage later in the battle. Luigi then kills one of the Soul Bubbles with a lucky bro flower. If a Soul Bubble is attacked and survives, it will either heal or revive an enemy, and I want to avoid this at all costs. On Mario's next turn, it's important to not kill either of the remaining enemies, since we want to kill all enemies with Luigi for the EXP bonus. Therefore he just uses a lucky bro flower to bring the Shroob Rex to low health so that Luigi can finish it off while he kills the last Soul Bubble. Mario's STACHE is so low that the chance of a lucky hit against the Shroob Rex is 1/100, but I got a very good seed for the battle which allowed this to happen without wasting much time at all. I was expecting to equip the space pants on Mario before this battle for the increased STACHE, but I didn't have to do that. Finally, Luigi kills the Shroob Rex and the 2nd Soul Bubble with an ice flower. I used an ice flower because it advances RNG more, since every hit checks whether to apply a debuff to the target. I wanted to advance RNG more in order to get the 100-point pants, a rare (2.25% chance) drop from the Shroob Rex. I got a significantly long string of of RNG values that didn't get the drop, so I had to advance it as much as possible.
	$LF
]p
[h4 
	" Ghoul Guy and Shroob Rex
	$LF
]h4
[p 
	"This battle is fought with the adults, since the babies are already level 10 with 31 POW, and if I fought it with the babies as well there would be unnecessary time taken up by level ups, with no extra damage dealt later. I waited for a seed in which the Ghoul Guy possesses the Shroob Rex, which makes it possible to win the battle on Luigi's first turn. As in the previous battle, I kill it with one non-lucky and one lucky bro flower, while manipulating another 100-point pants drop. Note that the Ghoul Guy gives EXP, but not the bonus EXP.
	$LF
]p
[h4 
	" Shroobsworth
	$LF
]h4
[p 
	"When a Shroobsworth dies, an Intern Shroob spawns. On the Intern Shroob's first turn, it will revive the Shroobsworth, which we want to avoid. So we have to kill the Intern Shroob before it gets a turn. This is done by killing the Shroobsworth with Mario so that Luigi gets the next turn. It is not quite possible for Mario to kill it on his first turn it has 160 HP and a lucky flower can do at most 148 damage, and a first strike and counter can't quite do 12 damage. Not to mention, it would have taken too long to manipulate the first flower to be a lucky hit. So I opt to deal the majority of damage with a lucky flower from Luigi, finishing it with a jump from Mario. Luigi can then kill the Intern Shroob right away with another lucky flower, manipulating the rare drop, supreme slacks. Note that the Intern Shroob is responsible for giving EXP and drops, not the Shroobsworth.
	$LF
]p
[h4 
	" Princess Shroob
	$LF
]h4
[p 
	"I equipped Big-POW badges on the adults, which give a temporary POW boost of 60% (1.6x) after getting a Great rating on a bro item. Luigi has more SPEED than Mario since he is wearing the supreme slacks. First Luigi does a Great copy flower to destroy Princess Shroob's shield and get the POW boost. Then Mario does a bro flower to get his POW boost, deal some damage, and manipulate a fast attack as well as good RNG on the upcoming red shell. Luigi's red shell hit does 6 damage and Mario's does 7, so the red shell takes a long time since she has 1700 HP.
	$LF
]p
[h4 
	" Elder Princess Shroob
	$LF
]h4
[p 
	"Like in the last battle, I first give the bros POW boosts by getting Great bro flowers. I can manipulate the second flower to be a lucky hit. During the second flower, I manipulate the saucer to drop a red shell, since I only got 2 red shells in the Shroob Castle dark room but I want to use 3. I already used one on Princess Shroob, and now I use one to kill the first phase of Elder Princess Shroob, and then on the 2nd phase's foot. It's necessary to kill the foot and then the crown in order to deal more than 1 damage per hit to Elder Princess Shroob. In the previous TAS, I killed the crown with a bro flower, but that was only possible because I had risk badges. I use a copy flower instead, which is not much slower. Finally, I am able to kill Elder Princess Shroob with the last copy flower.
	$LF
]p
[h4 
	" Shrowser
	$LF
]h4
[p 
	"This battle is straightforward. Shrowser's 3-fireballs-from-the-sky attack is pretty long but it took too much time to manipulate him to do it less than twice.
	$LF
]p
[h3 
	" Overworld Techniques and Glitches
	$LF
]h3
[h4 
	" Stair Jumping
	$LF
]h4
[p 
	"Mario's speed is decreased when he is on a slope and facing up the slope. By jumping from flat ground up the slope, this is avoided. If the slope is too long to ascend in a single jump, I can jump while facing perpendicular to the slope for one frame to maintain normal walking speed up slopes.
	$LF
]p
[h4 
	" Toad Boost
	$LF
]h4
[p 
	"When entering an NPC's hitbox from above, Mario is boosted out of its hitbox. I use this to save frames in Peach's Castle.
	$LF
]p
[h4 
	" Wall Boost
	$LF
]h4
[p 
	"Normal walking speed is 2 units per frame, or 1.5 units in each direction when walking diagonally. If Mario is touching a wall and moves diagonally against the wall, his speed will be 1.6 along the wall, so it's better to walk along the wall for a speed of 2. However, if Mario less than 1.5 units from a wall and walks diagonally against the wall, his distance from the wall is added to his speed along the wall on the next frame. For example, if he is 1 units from a wall, his speed the next frame will be 2.6 units along the wall.
	$LF
]p
[h4 
	" Ledge Boost
	$LF
]h4
[p 
	"Mario can get a boost when walking off a ledge. The size of the boost depends on the angle of movement relative to the angle of the ledge and the distance to the ledge the frame before walking off it. These boosts tend to be larger than wall boosts but smaller than toad boosts.
	$LF
]p
[h4 
	" Quick Drill
	$LF
]h4
[p 
	"The length of the baby drill entering-the-ground animation depends on the direction faced before pressing Y. It's fastest to face up-left before pressing Y. It's slowest to be facing up because the animation will be 18 frames longer.
	$LF
]p
[h4 
	" Corner Clips
	$LF
]h4
[p 
	"It's not fully known how corner clips work, but here is what I understand. The walls around a convex corner push Mario away from the walls and the corner when he walks along them towards the corner. However, when he walks along the walls away from the corner, they don't work properly. So we can first walk directly into the corner (perpendicular to the walls) and then walk away from the corner along the walls. From here we can walk out of bounds.
	$LF
]p
[p 
	"https://cdn.discordapp.com/attachments/211142106549452800/417926650597081089/ventclip.png
	$LF
]p
[h4 
	" Ledge Clips
	$LF
]h4
[p 
	"The game prevents stacking under a ceiling that's too low to fit the stack. However, if Mario is less than 1 pixel under a ledge and Luigi is far enough to the right of Mario and close enough to the ledge, the game will allow them to stack under a ceiling that's too low. Now if they walk or spin upwards, the game will try to move them to a place where they can fit. If there is a floor above them, they will be clipped up to that floor. This technique was first found in Superstar Saga by Mugg, and found/applied in this game by SolidifiedGaming.
	$LF
]p
[h4 
	" Spring Clips
	$LF
]h4
[p 
	"If Baby Mario falls off the left or right side of a spring without being ledge boosted, he can clip inside by immediately going back to the spring. Thus Baby Mario can stand on the ground right under a spring's surface, which is useful for top screen storage.
	$LF
]p
[h4 
	" Top Screen Storage (TSS)
	$LF
]h4
[p 
	"If the babies are in a top screen and the adults enter a bottom screen loading zone, the babies will be forced out of the top screen, in order to prevent a top screen corresponding to a room A being loaded at the same time as room B is loaded. TSS involves getting around this restriction and having a top screen loaded while the wrong bottom screen is loaded. There are a few types of TSS, but only one type is used in this run: spring TSS. If the babies use a spring just as the adults enter a loading zone, with the correct timing, the new bottom screen and the top screen will load at the same time, resulting in TSS. In 99% of cases, entering a loading zone requires having control of the pair that is entering the loading zone, since you need to walk into a loading zone and you can only walk with the pair you have control of. So to make this work, we need to have control of the adults, which means we won't have control of the babies. It is possible to do some actions, notably jumping, with the pair you don't have control of as long at least one of bros that you have control of is not on the ground. If Baby Mario clips into a spring and Baby Luigi jumps onto the spring, then as soon as Baby Mario jumps and lands on the spring, both babies will be on the spring so they will use the spring. This means that the babies can use a spring without having control of the babies. All of this allows spring TSS to be possible. First Luigi jumps so that he is in the air when Baby Mario jumps, so that we can retain control of the adults. Then Baby Mario jumps. 24 frames after Baby Mario jumps, the spring animation begins and we completely lose control of everyone. During this time Mario walks to the loading zone, but if he enters the loading zone too early, the top screen from the spring won't load correctly. So, Mario needs to jump into the loading zone so that the loading zone is delayed until he lands.
	$LF
]p
[p 
	"This explains how to get spring TSS, but not why it's useful. When the babies leave a hole from the top screen, the camera is locked and a script is run from the current bottom screen's script table. This will often softlock or crash the game depending what script is played. In this run, though, the babies are simply placed at coordinates (0,0) in the bottom screen room which is always out of bounds in the top-left corner.
	$LF
]p
[h4 
	" Money Glitch
	$LF
]h4
[p 
	"When selling all of an item, if you select the next item on the first frame possible, the sell price of the first item is stored on the second item. I use this to sell the starting gear and 8 Smash Eggs for 49 coins per item (the sell price of the salvage badge) and get over 1000 coins.
	$LF
]p
[h4 
	" Ball Displacement and Clips
	$LF
]h4
[p 
	"When entering bros. ball facing right or left, Mario is sent 8 units behind him. This has two uses. First, I always face backwards before using bros. ball so that behind Mario becomes the direction I want to travel in. Second, this displacement can clip through some walls, that are too thin or otherwise coded badly.
	$LF
]p
[h3 
	" Skips used in the run
	$LF
]h3
[h4 
	" M&L Block Tutorial Skip
	$LF
]h4
[p 
	"The trigger for the M&L block tutorial is only on the ground and narrow enough to jump over. It is still necessary to hit all of the blocks to advance to the next area, but Stuffwell's text and the camera movement can be skipped.
	$LF
]p
[h4 
	" Bowser's Castle Dark Room Skip
	$LF
]h4
[p 
	"By falling into the spikes right after hitting the shine block, the "hit by spikes" cutscene is delayed until the shine cutscene finishes. This gives a few frames for the babies to stand on the spikes without getting hurt. Baby Mario faces down here so that the end of the trick will work. Since both babies are on the ground, we can switch control to the adults which allows Mario to read the sign. Normally you completely lose control when reading a sign, and after closing the sign text, you regain control, which is exactly what happens here. As long as you advance the text fast enough, after closing the sign text you can regain control of the babies during the hit by spikes cutscene. This cutscene gives the babies a few properties, but the important one is that their height is increasing, so they are flying upwards. This allows Baby Mario to make it to the platform at the end of the dark room. If Baby Mario jumps, he will jump a normal jump height, fall until he reaches the ground, and then continue flying upwards again. I do this twice to avoid Baby Mario flying all the way off screen, which would end the hit by spikes cutscene and respawn him at the start of the dark room. He enters the loading zone when he reaches the ground, after the 2nd jump. During the cutscene, even though he can move, he can't change facing direction, and he needs to be facing down to enter the loading zone - this is why he faces down before Mario reads the sign.
	$LF
]p
[h4 
	" Toadwood Forest Spike Skip
	$LF
]h4
[p 
	"The area before Vim Factory is intended to be completed counter-clockwise, but this trick makes it possible to complete it clockwise, thereby skipping all of the auto-scrolling floating platforms. When Mario lands on the spikes, there is one frame when he is standing on the spikes before the hit by spikes cutscene starts. (Note that this frame only exists for some spike pits - it doesn't exist in Bowser's Castle dark room for instance.) On this frame, if Luigi is also on the ground, we can switch control of the babies. If Luigi is not on the spikes, this cancels the hit by spikes cutscene, so that when we switch back to the adults, Mario can freely walk on the spikes to the next room.
	$LF
]p
[h4 
	" Vim Factory Vent Clip
	$LF
]h4
[p 
	"This is a corner clip that works just as described above. Walking out of bounds is faster than navigating the vents, but more importantly it skips the first hammer tutorial battle.
	$LF
]p
[h4 
	" Vim Factory Ledge Clip
	$LF
]h4
[p 
	"You can do a ledge clip by first stacking under the intended entrance to the top screen with the babies and then holding up. This puts the babies inside the box, and they are stuck until Baby Mario hammers the box. From here Baby Mario can open the entrance to the next room.
	$LF
]p
[h4 
	" Yoshi's Island Cutscene Skips
	$LF
]h4
[p 
	"The Kylie Koopa, Yoob, and Kamek introduction cutscenes and the yoshi cookie cutscene can be skipped with two precise ledge clips. In order to clip up onto the huts, walking isn't enough since in this case it will push you down. They need to spin for just long enough to make it onto the hut roof, which counts as a floor.
	$LF
]p
[h4 
	" Colored Blocks Skip
	$LF
]h4
[p 
	"This skip uses spring TSS just as described above. When the babies leave the top screen corresponding to the lower room while the adults are in the hub room, the babies are spawned out of bounds in the hub room near the top loading zone. They can simply walk to the loading zone and then use the pipe block to proceed to the next area of Yoshi's Island.
	$LF
]p
[h4 
	" Kamek Skip
	$LF
]h4
[p 
	"Again, this uses spring TSS. Since it requires entering the loading zone with solo adults, we first need to open the door, and then we can do the TSS. After spawning out of bounds the babies can skip the Kamek battle by walking around the trigger and into the loading zone. The camera lock persists until halfway through the cutscene in which Yoob eats the bros.
	$LF
]p
[h4 
	" Blue Yoshi Puzzle Skip
	$LF
]h4
[p 
	"This uses a ledge clip to skip opening the door to the blue yoshi. Opening this door requires hitting a long button color combination. Even though it doesn't look like it, there is a floor above the walls that enclose the yoshi that we can ledge clip up to, and then fall off of.
	$LF
]p
[h4 
	" Yoob's Belly Clip
	$LF
]h4
[p 
	"This is another corner clip, but is much more precise than vent clip. There is a 3-pixel range in which the clip can be started, and not all subpixels in that range will work. Also, the adults have to be stacked in order to perform the clip because walking speed is halved while stacked. Before clipping, I position the babies such that the adults can pick them up later while staying out of bounds.
	$LF
]p
[h4 
	" Gate Skip
	$LF
]h4
[p 
	"This is the major breakthrough which led to such a large improvement. The gate to Shroob Castle only opens once you collect 5 cobalt star shards, which requires about an hour and a half of gameplay after the the time hole to Shroob Castle opens after beating Sunnycide. However, we can access the loading zone behind the gate as soon as the time hole opens by ball clipping through the right side of the gate. As with the Yoob's Belly Clip, I first position the babies such that the adults can pick them up without clipping back out of the gate.
	$LF
]p
[h4 
	" Baby Spin Skip
	$LF
]h4
[p 
	"After gate skip was found, it was still necessary to beat Petey Piranha in order to learn baby spin, which was required to get through Shroob Castle. Another ball clip on the first floor of Shroob Castle made it possible to get through Shroob Castle without baby spin, so it is possible to go to the end of the game right after the Shroob Castle time hole opens. This ball clips puts the adults inside a wall and then they are warped up to the floor (similar to a ledge clip). I can again pick up the babies from out of bounds and walk to the loading zone.
	$LF
]p
[h4 
	" Library Skip
	$LF
]h4
[p 
	"The east wing of the second floor is only supposed to be accessed after returning from the basement, since a tall bookshelf divides the library in half. But we can do a ledge clip to reach the floor above the top loading zone, and then ball clip to get out of bounds and roll past the bookshelf.
	$LF
]p
[h3 
	" Theoretical improvements
	$LF
]h3
[h4 
	" Elder Princess Shroob Skip
	$LF
]h4
[p 
	"There may be a way to skip the final boss, most likely by using Top Screen Storage to play one of the endgame cutscenes. If this were found, a "final boss skip" branch should be created, since I think the final boss is a very important part of the game and should be included in this game's main movie.
	$LF
]p
[h4 
	" Other theoretical sequence breaks
	$LF
]h4
[p 
	"Toadwood fire skip, End of Yoshi's Island cutscenes early
	$LF
]p
[h4 
	" Routing improvements
	$LF
]h4
[p 
	"There might be a better way to reach level 11 in Shroob Castle (I can't think of one). Additionally, it may be faster overall for the adults to reach level 12 before the final boss. I timed this to be around 10 seconds slower, but with better routing and RNG, it could be made to be slightly faster.
	$LF
]p
[h3 
	" Special thanks to...
	$LF
]h3
[p 
	"SolidifiedGaming, (as well as Really_Tall and GhostKing) for finding the glitches that made this improvement possible.
	$LF
]p
[p 
	"Jdaster64, for finding a lot of useful info like the RNG formula, attack constants, and stat increase tables which made routing the TAS infinitely easier.
	$LF
]p
[p 
	"Snoion and GhostKing for being modern runners of Partners in Time and pushing it to its RTA limits.
	$LF
]p
[p 
	"Anwonu, for putting so much time into this game, even though not much of his routing efforts can't be seen in this run. Still, I would have never been interested in TASing this game if it weren't for him.
	$LF
]p
[h3 
	" Suggested screenshots
	$LF
]h3
[p 
	"I like frame 281068 but it may be too similar to the current publication.
	[br 
	]br
	$LF
	"Frame 273515 showcases the main improvement but isn't especially flashy.
	[br 
	]br
	$LF
	"Frame 287569 looks a little more interesting on its own and is also part of one of the main improvements.
	$LF
]p
[hr 
]hr
[p 
	(__wikiLink|user:Mothrayas)
	": Judging.
	$LF
]p
[p 
	(__wikiLink|user:Mothrayas)
	": Splendid improvement, and great to see all the skips breaking apart most of the game now. Accepting as an improvement to the 
	(__wikiLink|3530M|published movie)
	".
	$LF
]p
[p 
	(__wikiLink|user:Spikestuff)
	": Publishing.
]p
