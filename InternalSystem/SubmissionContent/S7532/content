15
[div class=card mb-2 
	[div class=card-header 
		[strong 
			"Table of contents
		]strong
	]div
	[div class=card-body 
		[ul 
			[li 
				[a href=#Introduction 
					" Introduction
					$LF
				]a
			]li
			[li 
				[a href=#Emulation 
					" Emulation
					$LF
				]a
				[ul 
					[li 
						[a href=#RomInformation 
							" Rom Information
							$LF
						]a
					]li
					[li 
						[a href=#Emulator 
							" Emulator
							$LF
						]a
					]li
					[li 
						[a href=#RoutingBot 
							" Routing Bot
							$LF
						]a
					]li
					[li 
						[a href=#BirdSimulator 
							" Bird Simulator
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#Timing 
					" Timing
					$LF
				]a
			]li
			[li 
				[a href=#ActBreakdown 
					" Act Breakdown
					$LF
				]a
				[ul 
					[li 
						[a href=#ActI 
							" Act I
							$LF
						]a
					]li
					[li 
						[a href=#ActIi 
							" Act II
							$LF
						]a
					]li
					[li 
						[a href=#ActIii 
							" Act III
							$LF
						]a
					]li
					[li 
						[a href=#ActIv 
							" Act IV
							$LF
						]a
					]li
					[li 
						[a href=#ActV 
							" Act V
							$LF
						]a
					]li
					[li 
						[a href=#ActVi 
							" Act VI
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#FutureWork 
					" Future Work
					$LF
				]a
				[ul 
					[li 
						[a href=#FalseFrames 
							" False Frames
							$LF
						]a
					]li
					[li 
						[a href=#PreKill 
							" Pre-Kill
							$LF
						]a
					]li
					[li 
						[a href=#KnuckleSSkywalkGlitch 
							" Knuckle's Skywalk Glitch
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#AcknowledgementsAndAttributions 
					" Acknowledgements and Attributions
					$LF
				]a
			]li
			[li 
				[a href=#SuggestedThumbnails 
					" Suggested Thumbnails
					$LF
				]a
			]li
		]ul
	]div
]div
[h3 id=Introduction 
	" Introduction
	$LF
]h3
[pre 
	$LF
]pre
[div class=p 
	"Once again, after 6 long years, we manage to find a way to beat Ninja Gaiden faster than the previous movie by... ONE frame. The key to this improvement was the combination of (1) years of community-accrued knowledge of this game and its emulation, (2) breadth-first bot-driven exploration by eien86, (3) the development of an ad-hoc tool by Scumtron, that simulates how player movement and the fractional x position they spawn with affects bird position over time. We recommend reading the submission notes and comments from the previous 
	[a href=https://tasvideos.org/3223M rel=noopener external nofollow 
		"movie(s)
	]a
	" for an in-depth description.
	$LF
]div
[div class=p 
	"Although this movie saves only a single frame, it contains considerable changes to the route and entertainment-only parts to make for a noticeably different watching experience. The changes in route contain false frames: time saves in earlier stages which were later lost due to waiting for a favorable global RNG timer. These frames convey potential time saves and were therefore kept in the movie in hopes we will find a way to overcome their limitations. The only true frame saved was achieved by brute force optimized changes in routine stage 5, as explained later.
	$LF
]div
[div class=p 
	"The project was conducted in two stages. The first one (by eien86, from mid May to mid June) consisted of a full-re run of the current strats by the breadth first bot. The second stage (by Scumtron, from mid to end of June) consisted of creating the bird simulator and making numerous local improvements to the run. Although I (eien86) knew the game as a casual speedrun viewer, I had to learn the game mechanics in detail. Thankfully, Scumtron was always there to contribute with his in-depth knowledge of the game and to provide help in re-planning the route.
	$LF
]div
[h3 id=Emulation 
	" Emulation
	$LF
]h3
[h4 id=RomInformation 
	" Rom Information
	$LF
]h4
[ul 
	[li 
		" Name: Ninja Gaiden (U) 
		"[!]
		$LF
	]li
	[li 
		" SHA1: CA513F841D75EFEB33BB8099FB02BEEB39F6BB9C
		$LF
	]li
	[li 
		" MD5: 0C2CCCDA6BA6CAB7BEDE0FF05E7F6852
		$LF
	]li
]ul
[h4 id=Emulator 
	" Emulator
	$LF
]h4
[ul 
	[li 
		" EmuHawk 2.8.0 (Core: NesHawk)
		$LF
	]li
]ul
[div class=p 
	"Resynchronized from the initially submitted 
	"[EmuHawk 2.7.0 + QuickNES]
	" movie, using Scumtron's DPCM glitch detection tool, available 
	[a href=https://tasvideos.org/Forum/Topics/246?CurrentPage=4&Highlight=509658#509658 rel=noopener external nofollow 
		"here
	]a
	".
	$LF
]div
[h4 id=RoutingBot 
	" Routing Bot
	$LF
]h4
[ul 
	[li 
		" Bot: 
		[a href=https://github.com/SergioMartin86/jaffar rel=noopener external nofollow 
			"Jaffar
		]a
		" (new version in development)
		$LF
	]li
	[li 
		" Routing Core: QuickNES (Average Exploration Performance: 1.6M States/s)
		$LF
	]li
	[li 
		" Platform: AMD Ryzen Threadripper 3990X Processor (64 cores, 128 threads) + 256Gb RAM
		$LF
	]li
]ul
[h4 id=BirdSimulator 
	" Bird Simulator
	$LF
]h4
[ul 
	[li 
		" 
		[a href=https://tasvideos.org/UserFiles/Info/637923955744472700 rel=noopener external nofollow 
			"It simulates birds
		]a
		$LF
	]li
]ul
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/DtKjKL1/birdsim.png 
	]img
	$LF
]div
[div class=p 
	"Birds accelerate towards Ryu at 1/16th of a pixel per frame and inherit the low byte of their position from the last enemy to use the slot they spawn in. These two things alone wouldn't make them terribly difficult to manipulate, but the fact that enemy routines are skipped every 16 pixels the screen is scrolled adds enough complexity that the effort of making an external tool finally seemed worth it. This tool helped in finding a two frame faster solution to 4-2, greatly assisted in almost matching the old solution to 5-1, and generally helped rule out possibilites for other improvements in various stages.
	$LF
]div
[h3 id=Timing 
	" Timing
	$LF
]h3
[div class=p 
	"Here we show the timing of the new TAS and compare it with the older TAS. The game is structured into acts representing the story arcs in the game with bosses at the end; stages, the different playable parts of an act, and; substages, the division of a stage into multiple NES vertically stacked 'screens' to allow for the illusion of verticality within a given stage. The nomenclature goes as follows: III-2a, represents act 3, stage 2, substage a. Timing is structured as follows:
	$LF
]div
[ul 
	[li 
		" Substage timing starts from the very first frame where Ryu is playable (typically 2 frames before he appears on screen)
		$LF
	]li
	[li 
		" Substage transitions happen when substage number (0x006E) changes.
		$LF
	]li
	[li 
		" Stage transitions happen when game mode* (0x002D) has a non-zero value. Alternatively, the preserved value of the A register at the start of the NMI routine that happily serves this purpose quite well.
		$LF
	]li
	[li 
		" Act transitions happen when a Boss HP (0x0066) equals 0.
		$LF
	]li
]ul
[pre 
	[code 
		$UNPRINTABLE TEXT!!!
	]code
]pre
[div class=p 
	"(*) We ignore the single frame difference in boot-up between the different emulators, as these do not represent improvements in gameplay.
	$LF
]div
[h3 id=ActBreakdown 
	" Act Breakdown
	$LF
]h3
[h4 id=ActI 
	" Act I
	$LF
]h4
[div class=p 
	"Stage I-1 was largely unchanged, except for the introduction of slide walk, a pure entertainment gimmick. This boss fight remained the same, except the post-kill entertainment movements were changed.
	$LF
]div
[h4 id=ActIi 
	" Act II
	$LF
]h4
[div class=p 
	"Here a change in route was proposed by Scumtron and Bumbledon where the spin slash (a.k.a. Bzzzt) weapon is used instead of the windmill (a.k.a Swag) star. This results in a frame saved from not stopping to throw the star in Stage II-2.
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/HYzjPYj/ng1.png 
	]img
	$LF
]div
[div class=p 
	"This route was known years ago, but then dismissed because in the end it resulted in a false frame, due to the tosser in Act III. In this TAS, however, we took it this time in hopes we would save enough frames to make the global timer work in the end (spoiler: it didn't).
	$LF
]div
[div class=p 
	"At the end of Stage II-2b, the bot found a 2-frame faster way to climb the column. At this point, the new TAS is 3 frames faster than the old one.
	$LF
	"Scum: It's a shame that there aren't more places with a ladder adjacent to a barrier block like this, though if that were the case then perhaps somebody would have found this before the bot came along.
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/hm9vXv6/ng2.png 
	]img
	$LF
]div
[div class=p 
	"The boss fight remained largely unchanged, except for entertainment only movements.
	$LF
]div
[h4 id=ActIii 
	" Act III
	$LF
]h4
[div class=p 
	"This act contains many changes between the two movies. Through extensive botting, we found out that the fastest way to kill the end boss is to use the firewheel: 4 frames faster than windmill star, used in the old TAS. Therefore we use the throwing ninja star to get the firewheel in III-1a:
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/TB4YqSf/ng3.png 
	]img
	$LF
]div
[div class=p 
	"The boss fight itself is 4 frames faster, but getting the firewheel costs time.
	$LF
	"Throwing 3 ninja stars loses 3 frames, and the fact that ninja power remains 16, which modulo 5 is 1, means that 1 ninpo will remain at the end of the level, which loses 3 frames. Instead, we throw 5 stars and wait an additional frame to get the the tosser to cooperate. The 3 star option looks cleaner, but we needed those extra 3 frames to be during gameplay, not during the score tally, or the act IV boss would leave an extra second on the clock and cost another 3 frames. The tosser in stage III-2a acts as a gatekeeper, only allowing certain global timer values to be ones with good skips. Additionally, the old TAS loses one frame pre-shooting the windmill star before entering the boss fight (for a free pre-hit). Additionally, the firewheel route permits the rare alignment of spawn iterator, enemy subpixel, and ninja position that saves a frame by jumping over the guy at the end of the level.
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/C1PzgWN/ng4.png 
	]img
	$LF
]div
[div class=p 
	"At the end of all these changes, the new TAS ends up with a 2 frame advantage.
	$LF
]div
[h4 id=ActIv 
	" Act IV
	$LF
]h4
[div class=p 
	"Here we implemented Ninja Gaiden's hidden secret: *Train mode*. It activates whenever Ryu is in tracks.
	$LF
]div
[div class=p 
	"Scum: Through the BirdSim I found that if the boosting bird inherited a subpixel of five or six sixteenths then the extra frames lost manipulating it weren't necessary, saving 2 frames. I also determined that turning around (needed to deal with the pursuing green ninja, costs 2 frames) after the bird's first pass and before its second pass was required to get it to meet Ryu in the right spot. That rules out the alternative of turning around when landing on the mine cart before the bridge, which would only cost 1 frame.
	$LF
]div
[div class=p 
	"This boss fight remained the same. Post boss kill entertainment movements were changed.
	$LF
]div
[h4 id=ActV 
	" Act V
	$LF
]h4
[div class=p 
	"Stage 5-1 contains a tosser whose ending projectile position determines the path of the bird we use to skip parts throughout the level. Only a few global timer values give the correct value, so we needed to either give up those four frames won before to get the same timer as the old TAS or find an alternative. The use of the bird simulator was crucial in finding a way to exit the stage with some of the locally saved frames. In the end all it took was giving up half a pixel in the wall climb after the first boost and giving the bird an xsub of eight sixteenths to leave 5-1 without losing a frame. Unfortunately that half-pixel was enough to affect the timing of a bat spawn, requiring an extra special attack which meant losing 1 frame later on.
	$LF
]div
[div class=p 
	"Stage 5-2 contains the only true frame saved. By not grabbing the 10 ninpo in the middle, it is possible to end half a pixel to the left, allowing us to end the level one frame faster:
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/DwbRxh0/ng5.png 
	]img
	$LF
]div
[div class=p 
	"The problem remains, however, that now we have 10 fewer ninpo and we need to save two spin slash uses. The first spin slash was saved by the bot, which discovered a way to finish V-2c as fast as the old movie, but also taking +5 ninpo at the end. 
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/rcgQz9z/ng6.png 
	]img
	$LF
]div
[div class=p 
	"The remaining 5 ninpo was saved, as suggested by Scumtron, by not killing the last two enemies in stage V-3f. 
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=https://i.ibb.co/6gbhhgq/ng7.png 
	]img
	$LF
]div
[div class=p 
	"The boss fight was unaltered, except for the entertainment movements at the end.
	$LF
]div
[h4 id=ActVi 
	" Act VI
	$LF
]h4
[div class=p 
	"The tosser in VI-1 uses a bad pattern when arriving with -2 frames here, and we had to lose one frame beforehand to get the good pattern. Otherwise, the only difference in the last act was the need to adjust some use of ninpo due to the difference in enemy patterns due to arriving one frame faster. However, overall everything remained the same, except for some entertainment movement.
	$LF
]div
[h3 id=FutureWork 
	" Future Work
	$LF
]h3
[div class=p 
	"The fact that only one frame save persisted after so much work speaks volumes to the level of global and local optimization this movie has had throughout the years. We tried our best to bring all local saves towards the end of the game, but the sheer presence of randomness in the tossers, made this very difficult.
	$LF
]div
[h4 id=FalseFrames 
	" False Frames
	$LF
]h4
[div class=p 
	"As shown above, we found a bunch of false frames. These represent local optimization opportunities that should be considered by anyone wanting to improve this movie. How to fit these in a global plan that keeps those savings will be key to further improvements.
	$LF
]div
[h4 id=PreKill 
	" Pre-Kill
	$LF
]h4
[div class=p 
	"Joecurr discovered a way to pre-kill enemies or projectiles as soon as they spawn (see this 
	[a href=https://www.twitch.tv/videos/1497514873 rel=noopener external nofollow 
		"video
	]a
	"). This can be done by throwing a special attack timed to kill an enemy on the frame it exits the screen (or, in some cases, a sword attack as an enemy exits the top of the screen). This triggers the 'death' bit which isn't cleared because the explosion animation is not played. Therefore, the next enemy that uses the same slot will instantly die. We haven't found a use for this in a TAS yet, but could serve in the future to fix enemy patterns and fit the false frames.
	$LF
]div
[h4 id=KnuckleSSkywalkGlitch 
	" Knuckle's Skywalk Glitch
	$LF
]h4
[div class=p 
	"This is a  bug where a projectile shooting enemy is manipulated to enable sky walking. See the 
	[a href=https://www.youtube.com/watch?v=rIMaGYevbhk rel=noopener external nofollow 
		"video
	]a
	$LF
]div
[h3 id=AcknowledgementsAndAttributions 
	" Acknowledgements and Attributions
	$LF
]h3
[div class=p 
	"The bulk of this TAS work was done by the authors. We have received support from the Ninja Gaiden speedrunning community, especially Bumbledon and Joecurr, and blacksquall. It seems like a great coincidence that we finished the first version of this TAS the same day Arcus and TheRetroRunner got their PBs (11:35 and 11:34, respectively. GGS!).
	$LF
]div
[h3 id=SuggestedThumbnails 
	" Suggested Thumbnails
	$LF
]h3
[div class=p 
	"10506
	$LF
	"13768
	$LF
	"39057
	$LF
]div
[hr 
]hr
[div class=p 
	[a class=intlink href=/Users/Profile/feos 
		"feos
	]a
	": Claiming for judging.
	$LF
]div
[div class=p 
	[a class=intlink href=/Users/Profile/feos 
		"feos
	]a
	": 
	[a href=https://tasvideos.org/Forum/Posts/515254 rel=noopener external nofollow 
		"Replacing the movie
	]a
	" and accepting over 
	(__wikiLink|href=/3223M|implicitdisplaytext=3223M)
	".
	$LF
]div
[div class=p 
	"Publisher, please use the second movie from that post for encoding.
	$LF
]div
[hr 
]hr
[div class=p 
	[a class=intlink href=/Users/Profile/EZGames69 
		"EZGames69
	]a
	": Processing...
]div
