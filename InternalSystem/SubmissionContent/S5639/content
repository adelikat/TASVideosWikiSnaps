7
[h3 id=Sonic3KnucklesKnuckles100ByJoojamoiEvil3d 
	" Sonic 3 & Knuckles - Knuckles 100% by joojamoi & Evil_3D
	$LF
]h3
[h3 id=EmulatorAndToolsUsed 
	" Emulator and tools Used
	$LF
]h3
[ul 
	[li 
		" Gens Re-Recording 11b + Camera hack + Solidity and Terrain dysplay
		$LF
	]li
	[li 
		" 
		(__wikiLink|displaytext=Sonic TAS tools|href=/Forum/Topics/8827)
		" + Frame Advance
		$LF
	]li
]ul
[h3 id=GameObjectives 
	" Game objectives
	$LF
]h3
[ul 
	[li 
		" Collect all Chaos and Super emeralds even faster
		$LF
	]li
	[li 
		" Best Ending
		$LF
	]li
	[li 
		" 100% completion
		$LF
	]li
	[li 
		" No deaths
		$LF
	]li
	[li 
		" Aim for faster in-game time, not RTA
		$LF
	]li
	[li 
		" Takes damage to save time
		$LF
	]li
	[li 
		" Abuses programming errors
		$LF
	]li
	[li 
		" Manipulates luck and badniks
		$LF
	]li
	[li 
		" Avoids underflowing the horizontal position (see comments below)
		$LF
	]li
	[li 
		" No skip zones/acts 
		$LF
	]li
]ul
[h3 id=SuperHyperKnuckles 
	" Super/Hyper Knuckles
	$LF
]h3
[div class=p 
	"Knuckles when collect all Emeralds he can reach his super form, double the running, spindash, glide and climbing rate.
	$LF
]div
[h3 id=RunningSpeed 
	" Running Speed
	$LF
]h3
[pre 
	"    2048 subpixels (8 pixels) per frame
	$LF
]pre
[h3 id=RunningBrakingRate 
	" Running Braking rate
	$LF
]h3
[pre 
	"    192 subpixels (3/4 pixels) per frame per frame
	$LF
]pre
[h3 id=RunningDecelerationVerticalHoldingForwardAtOrBelowRunningSpeed 
	" Running Deceleration (vertical, holding forward, at or below Running Speed)
	$LF
]h3
[pre 
	"    8 subpixels (1/32 pixels) per frame per frame
	$LF
]pre
[h3 id=MaxSpindashSpeed 
	" Max Spindash Speed
	$LF
]h3
[pre 
	"    3840 subpixels (15 pixels) per frame
	$LF
]pre
[h3 id=GlidingXAcceleration 
	" Gliding X Acceleration
	$LF
]h3
[pre 
	"    12 subpixels (3/64 pixels) per frame per frame
	$LF
]pre
[h3 id=DoubleTheFollowingValues 
	" Double the following values
	$LF
]h3
[pre 
	"    Running Acceleration, Air Acceleration, Climbing Rate
	$LF
]pre
[h3 id=HyperForm 
	" Hyper Form
	$LF
]h3
[ul 
	[li 
		" By gliding into a wall when either his horizontal or vertical velocity exceed a certain value, Hyper Knuckles can cause an earthquake which destroys all enemies within rendering range of the camera. This will also enter any active star rings for bonus stages within rendering range.
		$LF
	]li
]ul
[h3 id=HorizontalUnderflow 
	" Horizontal Underflow
	$LF
]h3
[div class=p 
	"An explication by Marzojr
	$LF
]div
[ul 
	[li 
		" This run uses almost all of the known glitches and abuses: the only exception is the underflowing of the horizontal coordinate; this is the technical form of saying "teleporting from the start to the end of a level" for this game.
		$LF
	]li
]ul
[h3 id=Comments 
	" Comments
	$LF
]h3
[div class=p 
	"This is an improvement of 
	(frames|amount=1926)
	" seconds over the previous submission. 
	(frames|amount=1444)
	" seconds was saved in special stages by using newly found glitches and by optimizing routes. Other 
	(frames|amount=482)
	" seconds was saved by optimizing other levels and using a new stair clip in Lava Reef 2.
	$LF
]div
[div class=p 
	"All special stages were recorded by joojamoi and everything else was copied from previous movie by Evil_3D or remade by him.
	$LF
]div
[h4 id=FramesSavedInSpecialStages 
	" Frames saved in special stages.
	$LF
]h4
[div class=p 
	"The special stages are listed in the order they are played in the movie.
	$LF
	"Special stages were timed from entering the big ring to when the act begins reloading. Or more accurately by wathing special stage flag at memory address 00FFFE48, timing is started when the flag is set to 1 and stopped when it's set to 0.
	$LF
]div
[table 
	[tbody 
		[tr 
			[th 
				"stage
			]th
			[th 
				"frames saved
			]th
		]tr
		[tr 
			[td 
				"Special stage 1
			]td
			[td 
				"37
			]td
		]tr
		[tr 
			[td 
				"Special stage 2
			]td
			[td 
				"105
			]td
		]tr
		[tr 
			[td 
				"Special stage 3
			]td
			[td 
				"39
			]td
		]tr
		[tr 
			[td 
				"Special stage 4
			]td
			[td 
				"345
			]td
		]tr
		[tr 
			[td 
				"Special stage 5
			]td
			[td 
				"40
			]td
		]tr
		[tr 
			[td 
				"Special stage 6
			]td
			[td 
				"190
			]td
		]tr
		[tr 
			[td 
				"Special stage 7
			]td
			[td 
				"47
			]td
		]tr
		[tr 
			[td 
				"Special stage 8
			]td
			[td 
				"108
			]td
		]tr
		[tr 
			[td 
				"Special stage 9
			]td
			[td 
				"158
			]td
		]tr
		[tr 
			[td 
				"Special stage 10
			]td
			[td 
				"31
			]td
		]tr
		[tr 
			[td 
				"Special stage 11
			]td
			[td 
				"73
			]td
		]tr
		[tr 
			[td 
				"Special stage 12
			]td
			[td 
				"3
			]td
		]tr
		[tr 
			[td 
				"Special stage 13
			]td
			[td 
				"66
			]td
		]tr
		[tr 
			[td 
				"Special stage 14
			]td
			[td 
				"202
			]td
		]tr
		[tr 
			[td 
				"total
			]td
			[td 
				"1444
			]td
		]tr
	]tbody
]table
[h4 id=OtherSavesLosses 
	" Other saves/losses
	$LF
]h4
[table 
	[tbody 
		[tr 
			[th 
				"Stage
			]th
			[th 
				"frames saved/lost
			]th
		]tr
		[tr 
			[td 
				"Marble Garden Zone ACT 2
			]td
			[td 
				"0
			]td
		]tr
		[tr 
			[td 
				"Flying Battery Zone ACT 2
			]td
			[td 
				"34
			]td
		]tr
		[tr 
			[td 
				"Sandopolis Zone ACT 2
			]td
			[td 
				"322
			]td
		]tr
		[tr 
			[td 
				"Lava Reef Zone ACT 2
			]td
			[td 
				"127
			]td
		]tr
		[tr 
			[td 
				"Sky Sanctuary Zone
			]td
			[td 
				"-1
			]td
		]tr
		[tr 
			[td 
				"Total
			]td
			[td 
				"482
			]td
		]tr
	]tbody
]table
[h3 id=NewTricksAndGlitches 
	" New tricks and glitches
	$LF
]h3
[h4 id=TurningSpheresIntoRingsWithoutSurroundingThemWithRedSpheresRingsGlitch 
	" Turning spheres into rings without surrounding them with red spheres (rings glitch)
	$LF
]h4
[div class=p 
	"This discovery is what lead me into this whole project of trying to find uses for the glitch and improving the special stages. All other glitches and improvements were found more or less by chance during planning and testing new routes.
	$LF
]div
[div class=p 
	"Here's a more detailed explanation of the glitch. The algorithm which turns blue spheres surrounded by red spheres into rings seems to work by trying to find a closed path of red spheres with following rules:
	$LF
]div
[ul 
	[li 
		" Start from the last collected sphere.
		$LF
	]li
	[li 
		" Path must not cross itself (same red sphere cannot be used twice).
		$LF
	]li
	[li 
		" Path must be closed (return back to starting point).
		$LF
	]li
	[li 
		" Path must not do sharp turns (no U-turn on 2x2 area).
		$LF
	]li
]ul
[div class=p 
	"If such path is found then the inside of the path is determined only by the first turn the algorithm has taken. This is where the algorithm goes wrong and it can be tricked to mark a sphere on the outside as being inside the path. Then starting from the blue spheres on "inside" the algorithm uses flood fill to recursively convert all touching blue spheres (including diagonals) into rings. And finally all red spheres next to the converted blue spheres are converted into rings.
	$LF
]div
[div class=p 
	"Below is a diagram which illustrates how the algorithm works. In each case two first images are showing the different found paths and the third image is the result.
	$LF
]div
[div class=p 
	[img class=embed mw-100 src=http://i.imgur.com/9dtUGU3.png 
	]img
	$LF
]div
[div class=p 
	"Used in special stages 1, 2, 3, 4, 6, 9, 13 and 14.
	$LF
]div
[h4 id=TurningOnRedSpheres 
	" Turning on red spheres
	$LF
]h4
[div class=p 
	"Under certain conditions it's possible to jump directly on a red sphere and turn on it without losing. This trick likely has something to do with subpixel position. At lowest speed (first 1800 frames of the stage) it's possible to turn in the same direction as what was the previous turn. After speedup things get somewhat more complicated.
	$LF
]div
[div class=p 
	"Used in special stages 3, 5 and 7 (though in stage 3 this does not save any time).
	$LF
]div
[h4 id=OptimizingEmeraldPosition 
	" Optimizing emerald position
	$LF
]h4
[div class=p 
	"After the last blue sphere is collected, Knuckles keeps walking for 85 frames at the same speed what he had when collecting the last sphere. At this point Knuckles' speed is set to 2048 (which equals to moving 1 square every 32 frames) and the emerald appears in the intersection which is 7.5-8.5 squares in front of Knuckles and the stage ends when Knuckles hits the emerald. So the difference between shortest and longest walk to the emerald is about 32 frames.
	$LF
]div
[div class=p 
	"There are a handful of ways to manipulate Knuckles' position to have the emerald appear as close as possible:
	$LF
]div
[ul 
	[li 
		" Jumping on the last sphere.
		$LF
	]li
	[li 
		" Turning on the last sphere.
		$LF
	]li
	[li 
		" Changing from reverse to forward a few frames before hitting the last sphere. This is the most useful because this allows quite precise fine tuning especially when combined with turning on the last sphere.
		$LF
	]li
]ul
[div class=p 
	"A script was used to try going forward and turning on different frames.
	$LF
]div
[div class=p 
	"Used in special stages 1, 2, 3, 4, 5, 6, 7, 10, 12 and 14.
	$LF
]div
[h4 id=EvenMoreBumperAbuse 
	" Even more bumper abuse
	$LF
]h4
[div class=p 
	"Used extensively in most of the levels mostly to optimize turns and routes. Bouncing twice on the same bumper in 11th special stage is kind of glitchy too.
	$LF
]div
[div class=p 
	"Used in all but one stage.
	$LF
]div
[h4 id=EnteringFirstInputBeforeSpecialStageBeginsToLoad 
	" Entering first input before special stage begins to load
	$LF
]h4
[div class=p 
	"It's possible to start special stages 1 frame earlier by entering input on the frame before the special stage begins to load (frame before lag frames). For some reason this input is buffered until the special stage has loaded and begins to take input.
	$LF
]div
[div class=p 
	"Used in every special stage except where the next trick ends up saving more time.
	$LF
]div
[h4 id=DelayingStartBy12Frames 
	" Delaying start by 1-2 frames
	$LF
]h4
[div class=p 
	"This one I couldn't completely figure out but I think it has something to do with turns taking variable number of frames after the first speedup (14-16 frames). For reference, before speedup turning always takes 14 frames when turning in the same direction as last turn and 15 frames in the opposite direction.
	$LF
]div
[h3 id=StageByStageCommentsSpecialStages 
	" Stage by stage comments (special stages)
	$LF
]h3
[h4 id=SpecialStage1 
	" Special stage 1
	$LF
]h4
[div class=p 
	"37 frames saved. Starts on frame 903.
	$LF
]div
[div class=p 
	"Most of the save comes from using rings glitch at the first and last 4x4. (frames 1100-1600 and 3300-3600)
	$LF
]div
[div class=p 
	"Saved 2 frames by delaying start by 2 frames. Delay itself wastes 2 frames but 4 frames are gained later on because some turns are faster after speedup.
	$LF
]div
[div class=p 
	"Saved 1 frame by going reverse near end. (frame 3150) Reversing wastes 13 frames but gains 14 frames later because it allows better positioning when the emerald appears. (frame 3666)
	$LF
]div
[div class=p 
	"Lost 1 frame on ring bonus.
	$LF
]div
[h4 id=SpecialStage2 
	" Special stage 2
	$LF
]h4
[div class=p 
	"105 frames saved. Starts on frame 6424.
	$LF
]div
[div class=p 
	"Most of the save comes from new route at the second 3x4 and using the rings glitch at the 5x5. (frames 7290-7880)
	$LF
]div
[div class=p 
	"Saved 6 frames by jumping at the end. (frame 9314) This delays collecting the last blue sphere by 4 frames but gains 10 frames by making the emerald appear closer.
	$LF
]div
[div class=p 
	"Lost 2 frames on ring bonus.
	$LF
]div
[h4 id=SpecialStage3 
	" Special stage 3
	$LF
]h4
[div class=p 
	"39 frames saved. Starts on frame 15218.
	$LF
]div
[div class=p 
	"Saved about 26 frames on the last 4x4. (frames 18220-18550)
	$LF
]div
[div class=p 
	"Saved about 13 frames by delaying start by 1 frame and staying reverse at the end and using that to get into better position when the emerald appears. (frame 18915)
	$LF
]div
[div class=p 
	"Turning on the red sphere did not gain or lose any frames. So why not? (frames 17510-17550)
	$LF
]div
[div class=p 
	"Lost 1 frame on ring bonus.
	$LF
]div
[h4 id=SpecialStage4 
	" Special stage 4
	$LF
]h4
[div class=p 
	"345 frames saved. Starts on frame 21179.
	$LF
]div
[div class=p 
	"Saved 5 frames by starting input a frame earlier and optimizing the first 3x3. (frames 21400-21600)
	$LF
]div
[div class=p 
	"Saved 33 frames by optimizing the last 3x3. (frames 23140-23390)
	$LF
]div
[div class=p 
	"Saved 285 frames by using the rings glitch at the middle. (frames 23550-23770)
	$LF
]div
[div class=p 
	"Saved 23 frames at the end by pressing up and left to get the emerald appear much closer. (frame 23763) Without this trick it would have been 7 frames faster to collect the middle earlier, right after the first 3x3 (around frame 21660-).
	$LF
]div
[div class=p 
	"Lost 1 frame on ring bonus.
	$LF
]div
[h4 id=SpecialStage5 
	" Special stage 5
	$LF
]h4
[div class=p 
	"40 frames saved. Starts on frame 28244.
	$LF
]div
[div class=p 
	"Saved 13 frames with some subpixel manipulation and a series of frame perfect jumps (3 frame perfect jumps in a row). Turning a bit late on one corner (frame 29951) delays movement by one frame and adjusts subpixel position for later use. The one frame delay is required for turning left on the red sphere a bit later (without delay it would be possible to turn right but turning left would end the stage). And the subpixel position is required to get over the bumper and hit the blue sphere at the end after a series of frame perfect jumps. Missing any of the jumps by a single frame would either jump over the blue sphere or hit a red sphere. Missing any two jumps by a single frame would also hit the bumper. (frames 30329-30490)
	$LF
]div
[div class=p 
	"Saved 27 frames by staying reverse until the end to make the emerald appear closer. (frame 30598)
	$LF
]div
[h4 id=SpecialStage6 
	" Special stage 6
	$LF
]h4
[div class=p 
	"190 frames saved. Starts on frame 33084.
	$LF
]div
[div class=p 
	"Completely new route. This stage was maybe the hardest to optimize due to enormous amount of possibilities to do those 4x4s and the corridors. And changing route in one of them will almost certainly change routes on other sectors too.
	$LF
	"The final route ended up being about 20 squares (10%) longer than old route but has 34 turns less (50 vs 84).
	$LF
]div
[div class=p 
	"One of the tested routes was whopping 45-50 squares (25%) longer than the old route but still about 100 frames faster because it also had 50 turns less (34 vs 84).
	$LF
]div
[h4 id=SpecialStage7 
	" Special stage 7
	$LF
]h4
[div class=p 
	"47 frames saved. Starts on frame 41927.
	$LF
]div
[div class=p 
	"Saved 6 frames by optimizing start and jumping on a bumper. (frame 43456)
	$LF
]div
[div class=p 
	"Saved the rest by turning on a red sphere (frames 43860-43920) and staying reverse to get into better position when the emerald appears. (frame 44006)
	$LF
]div
[div class=p 
	"Had to waste 1 frame on suboptimal turn to be able to turn on the red sphere. Also had to delay 2 more frames to gain 3 frames at the end. (frames 43656, 43688 and 43834)
	$LF
]div
[h4 id=SpecialStage8S3KStage6 
	" Special stage 8 (S3&K stage 6)
	$LF
]h4
[div class=p 
	"108 frames saved. Starts on frame 84625.
	$LF
]div
[div class=p 
	"More conveniently placed bumpers. (whole first half of the stage, frames 85040-85800)
	$LF
]div
[div class=p 
	"Taking shorter and faster route over some bumpers. (frames 86100-86200)
	$LF
]div
[div class=p 
	"Saved 6 frames on ring bonus.
	$LF
]div
[h4 id=SpecialStage9S3KStage7 
	" Special stage 9 (S3&K stage 7)
	$LF
]h4
[div class=p 
	"158 frames saved. Starts on frame 89537.
	$LF
]div
[div class=p 
	"Completely new route.
	$LF
]div
[h4 id=SpecialStage10S3KStage4 
	" Special stage 10 (S3&K stage 4)
	$LF
]h4
[div class=p 
	"31 frames saved. Starts on frame 94938.
	$LF
]div
[div class=p 
	"Optimized emerald to appear closed by turning at the end. (frame 98067)
	$LF
]div
[div class=p 
	"Not going reverse around frame 97850 and simply jumping over the last yellow sphere around frame 98040 would have been 23 frames faster than old route.
	$LF
]div
[h4 id=SpecialStage11S3KStage5 
	" Special stage 11 (S3&K stage 5)
	$LF
]h4
[div class=p 
	"73 frames saved. Starts on frame 100229.
	$LF
]div
[div class=p 
	"Bumper ride in the middle saved about 14 frames. (frames 101040-101200)
	$LF
]div
[div class=p 
	"About 53 frames were saved with a new route starting after the bumper ride in the middle. (frames 101200-end)
	$LF
]div
[div class=p 
	"Jumping at the end saved 6 frames. (frame 102963)
	$LF
]div
[h4 id=SpecialStage12S3KStage2 
	" Special stage 12 (S3&K stage 2)
	$LF
]h4
[div class=p 
	"3 (4) frames saved. Starts on frame 105056.
	$LF
]div
[div class=p 
	"4 frames might not be a lot but I had almost given up with getting any improvement at all in this stage. The previous route already was the best I could find but finally also this stage got some improvement, or in fact 2 different improvements.
	$LF
]div
[div class=p 
	"3 frames were saved by turning at the very end. (frame 106871)
	$LF
]div
[div class=p 
	"1 more frame could be saved by starting input before the stage begins loading but this frame was sacrificed to resync Mushroom Hill Zone act 1 boss.
	$LF
]div
[h4 id=SpecialStage13S3KStage3 
	" Special stage 13 (S3&K stage 3)
	$LF
]h4
[div class=p 
	"66 frames saved. Starts on frame 111868.
	$LF
]div
[div class=p 
	"New route in the beginning and the end. (frames 112020-112170 and 113660-end)
	$LF
]div
[h4 id=SpecialStage14S3KStage1 
	" Special stage 14 (S3&K stage 1)
	$LF
]h4
[div class=p 
	"202 frames saved. Starts on frame 117275.
	$LF
]div
[div class=p 
	"Completely new route. There was also yet another totally different route which started with 180 degree turn but that route ended up being just 3 frames slower than this route.
	$LF
]div
[div class=p 
	"Also some more bumper trickery. (frames 118910-119420)
	$LF
]div
[h3 id=Evil3dStageByStageCommentsOtherLevels 
	" Evil_3D Stage by stage comments (other levels)
	$LF
]h3
[h4 id=MarbleGarden2 
	" Marble Garden 2
	$LF
]h4
[div class=p 
	"0 frames saved/lost.
	$LF
]div
[div class=p 
	"The boss fight was remade because of desync but no frames were gained or lost.
	$LF
]div
[h4 id=FlyingBattery2 
	" Flying Battery 2
	$LF
]h4
[div class=p 
	"34 frames saved.
	$LF
]div
[div class=p 
	"I remade the boss battle here because I hit the boss in a wrong frame and I lost one hit in the previous movie. So I saved 30 frames for an extra hit and 4 more for better positioning.
	$LF
]div
[h4 id=Sandopolis2 
	" Sandopolis 2
	$LF
]h4
[div class=p 
	"322 frames saved.
	$LF
]div
[div class=p 
	"Used the same route as in Knuckles any% TAS and saved 1 frame in the boss compared to this movie. So an Knuckles any% completed revision is in my TODO list in a far future.
	$LF
]div
[h4 id=LavaReef2 
	" Lava Reef 2
	$LF
]h4
[div class=p 
	"127 frames saved.
	$LF
]div
[div class=p 
	"I discovered a stair clip in the beginning of the level, thanks to this I can zip directly to the giant ring in Knuckles' path, thanks to this some objects are in more friendly position and I can save more time compared to the previous movie.
	$LF
]div
[h4 id=SkySanctuary 
	" Sky Sanctuary
	$LF
]h4
[div class=p 
	"1 frame lost.
	$LF
]div
[div class=p 
	"I lost 1 frame because Mecha Sonic has very random and unfriendly attack patterns and with the new times in the movie the patters changes drastically, so when SSZ start I do micro pauses to manipulate his attack patterns. It's a shame to have lost 1 frame here, but well, if I had not done the pauses I would have lost 10+ seconds in comparison. And thanks to marzojr for his help in SSZ.
	$LF
]div
[h3 id=OtherComments 
	" Other comments
	$LF
]h3
[div class=p 
	"Special thanks to mike89 and Evil_3D.
	$LF
]div
[div class=p 
	"mike89 for showing one variation of this glitch (case 2 in the illustration) in his stream which made me research the subject way too much.
	$LF
]div
[div class=p 
	"Evil_3D for helping with desyncs and making the previous movie which was used as a base for this movie.
	$LF
]div
[h4 id=SuggestedScreenshots 
	" Suggested screenshots
	$LF
]h4
[div class=p 
	"7828, 30364
	$LF
]div
[hr 
]hr
[div class=p 
	[a class=intlink href=/Users/Profile/feos 
		"feos
	]a
	": Judging... & Knuckles
	$LF
]div
[div class=p 
	[a class=intlink href=/Users/Profile/feos 
		"feos
	]a
	": Improvement over 
	(__wikiLink|href=/3422M|implicitdisplaytext=3422M)
	" is quite clear and nice, so no doubts in obsoleting it.
	$LF
]div
[div class=p 
	"The submission discussion though turned towards the best way to perform a glitchless run, despite of the issues mentioned in my previous judgment of this branch. But I won't be addressing them this time, because they don't affect this run at all, even in observable future. Let's leave the glitchless branch definition to the Sonic runners, and whenever they come up with something people can evaluate, we'll just treat it as usual and decide when it's submitted.
	$LF
]div
[div class=p 
	"& Knuckles & accepting.
	$LF
]div
[div class=p 
	[a class=intlink href=/Users/Profile/Fog 
		"Fog
	]a
	": Publishing... & Knuckles.
]div
