104
[div class=p 
	"This page provides instructions and tips for installing Windows in PCem to make tool-assisted speedruns. The entirety of the 
	(__wikiLink|displaytext=main guide|href=/EmulatorResources/PCem)
	" applies here too. To discuss this setup and its usage, please 
	(__wikiLink|displaytext=visit this thread|href=/Forum/Topics/24903)
	".
	$LF
]div
[div class=p 
	"These guidelines will help you make a TAS that people will be able to sync on other machines. If nobody else can sync your run, then it will probably not get accepted!
	$LF
]div
[div class=p 
	"We cannot distribute a fully configured OS hard drive image like we did with the DOS configurations, so you will need to install Windows yourself. But we can provide a libTAS movie that you can run and it will automatically install Windows onto a hard drive image for you.
	$LF
]div
[div class=p 
	"Be aware of our Movie Rules for 
	(__wikiLink|displaytext=libTAS movies|href=/EmulatorResources/LibTAS#MovieSubmissions)
	" and especially for running 
	(__wikiLink|displaytext=PCem in libTAS|href=/EmulatorResources/PCem#MovieSubmissions)
	".
	$LF
]div
[div class=card mb-2 
	[div class=card-header 
		[strong 
			"Table of contents
		]strong
	]div
	[div class=card-body 
		[ul 
			[li 
				[a href=#WhatYouLlNeed 
					" What you'll need
					$LF
				]a
				[ul 
					[li 
						[a href=#CommonFiles 
							" Common files
							$LF
						]a
					]li
					[li 
						[a href=#OsDependentFiles 
							" OS dependent files
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#InstallingTheOs 
					" Installing the OS
					$LF
				]a
				[ul 
					[li 
						[a href=#Encodes 
							" Encodes
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#UsingWindowsWithLibtas 
					" Using Windows with libTAS
					$LF
				]a
				[ul 
					[li 
						[a href=#FlashBinAndNvr 
							" flash.bin and NVR
							$LF
						]a
					]li
					[li 
						[a href=#LibtasSettings 
							" libTAS Settings
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#Trivia 
					" Trivia
					$LF
				]a
			]li
		]ul
	]div
]div
[h2 id=WhatYouLlNeed 
	" What you'll need
	$LF
]h2
[div class=p 
	"The steps for installing 
	[em 
		"Windows 95
	]em
	" or 
	[em 
		"Windows XP
	]em
	" in PCem under libTAS are similar. You will need a number of files matched exactly by name and hashsum, and the steps below largely involve identifying the correct files and ensuring they are in the correct locations. Consult the 
	(__wikiLink|displaytext=Windows configuration|href=/EmulatorResources/PCem/Windows/Configurations)
	" page for additional details including hashsum information as well as full hardware specifications. The following elements should be in place to complete a Windows installation using a libTAS movie file:
	$LF
]div
[h3 id=CommonFiles 
	" Common files
	$LF
]h3
[ul 
	[li 
		" 
		(__wikiLink|displaytext=libTAS and PCem|href=/EmulatorResources/PCem#WhatYouLlNeed)
		" installed (ensure 
		[code 
			"~/.pcem/pcem.cfg
		]code
		" has 
		[code 
			"confirm_on_stop_emulation = 0
		]code
		" set).
		$LF
	]li
	[li 
		" ROM files for PCem v17. We can't distribute them. Place all PCem ROMs in 
		[code 
			"~/.pcem/roms/
		]code
		". File names are case-sensitive!
		$LF
		[ul 
			[li 
				" The files you'll need for Windows are: 
				[code 
					"ga686bx/6BX.F2a
				]code
				", 
				[code 
					"voodoo3_3000/3k12sd.rom
				]code
				", and 
				[code 
					"awe32.raw
				]code
				". Their hashsums are provided in the 
				(__wikiLink|displaytext=Windows common configuration|href=/EmulatorResources/PCem/Windows/Configurations)
				" section.
				$LF
			]li
		]ul
	]li
	[li 
		" An empty 4GB hard drive image file (
		[a href=https://files.tasvideos.org/common/Wiki/pcem/windows/windowsxp.img.7z rel=noopener external nofollow 
			"download link
		]a
		")
		$LF
		[ul 
			[li 
				" If you are installing Windows 95, just rename the 
				[code 
					"windowsxp.img
				]code
				" file to 
				[code 
					"windows95b.img
				]code
				" or similar.
				$LF
			]li
		]ul
	]li
	[li 
		" Make sure 
		[code 
			"~/.pcem/roms/ga686bx/flash.bin
		]code
		" and 
		[code 
			"~/.pcem/nvr/windowsxp.ga686bx.nvr
		]code
		" files do not exist! If you write to disk or use PCem outside of libTAS, delete the files again before installing.
		$LF
	]li
]ul
[h3 id=OsDependentFiles 
	" OS dependent files
	$LF
]h3
[table 
	[tbody 
		[tr 
			[th 
				" File 
			]th
			[th 
				" Windows 95 
			]th
			[th 
				" Windows XP 
			]th
		]tr
		[tr 
			[td 
				" 
				[b 
					"Windows installation CD image
				]b
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=Windows 95b OSR 2|href=/EmulatorResources/PCem/Windows/Configurations/95#Windows95Cd)
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=Windows XP SP3 Home Edition|href=/EmulatorResources/PCem/Windows/Configurations/XP#WindowsXpCd)
				" 
			]td
		]tr
		[tr 
			[td 
				" 
				[b 
					"Utilities CD with extra dependencies
				]b
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=Windows 95 utilities ISO|href=/EmulatorResources/PCem/Windows/Configurations/95#UtilitiesCd)
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=Windows XP utilities ISO|href=/EmulatorResources/PCem/Windows/Configurations/XP#UtilitiesCd)
				" 
			]td
		]tr
		[tr 
			[td 
				" 
				[b 
					"Boot floppy
				]b
				" (Windows 95 only)
			]td
			[td 
				"  
				(__wikiLink|displaytext=Microsoft Windows 95 OSR2 - Boot Disk|href=/EmulatorResources/PCem/Windows/Configurations/95#BootFloppy)
				" 
			]td
			[td 
				" 
			]td
		]tr
		[tr 
			[td 
				" 
				[b 
					"Machine config file
				]b
				" (update each 
				[code 
					" /full/path/to/
				]code
				") 
			]td
			[td 
				" 
				(__wikiLink|displaytext=windows95b.cfg|href=/EmulatorResources/PCem/Windows/Configurations/95#Config)
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=windowsxp.cfg|href=/EmulatorResources/PCem/Windows/Configurations/XP#Config)
				" 
			]td
		]tr
		[tr 
			[td 
				" 
				[b 
					"OS installation movie file for libTAS
				]b
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=Windows 95 installation .ltm|href=/EmulatorResources/PCem/Windows/Configurations/95#Windows95LibtasMovieFile)
				" 
			]td
			[td 
				" 
				(__wikiLink|displaytext=Windows XP installation .ltm|href=/EmulatorResources/PCem/Windows/Configurations/XP#WindowsXpLibtasMovieFile)
				" 
			]td
		]tr
	]tbody
]table
[h2 id=InstallingTheOs 
	" Installing the OS
	$LF
]h2
[div class=p 
	"Run PCem in libTAS as follows (similar to 
	(__wikiLink|displaytext=the main PCem guide|href=/EmulatorResources/PCem#Settings)
	"):
	$LF
]div
[ol 
	[li 
		" Set the game executable to the full path to PCem, usually 
		[code 
			"/usr/bin/pcem
		]code
		".
		$LF
	]li
	[li 
		" Set the command line to 
		[code 
			"--config /full/path/to/config.cfg
		]code
		", substituting the path of your 
		[code 
			".cfg
		]code
		" file. Use the full path, do not shorten it with 
		[code 
			"~
		]code
		".
		$LF
	]li
	[li 
		" 
		[b 
			"Uncheck
		]b
		" 
		[em 
			"Runtime -> Prevent writing to disk
		]em
		" for the installation movie only (remember to check this back after the OS installation is complete).
		$LF
	]li
	[li 
		" Play back the matching installation movie above (fast-forward should work).
		$LF
	]li
	[li 
		" If something is missing and the process fails, delete 
		[code 
			"~/.pcem/roms/ga686bx/flash.bin
		]code
		" and 
		[code 
			"~/.pcem/nvr/windowsxp.ga686bx.nvr
		]code
		" and recreate an empty 4GB hard drive image before trying again.
		$LF
	]li
]ol
[div class=p 
	"When the Windows installation completes successfully, you will have 
	[code 
		"flash.bin
	]code
	", 
	[code 
		".nvr,
	]code
	" and  
	[code 
		".img
	]code
	" files that represent your setup. See descriptions/annotations of respective OS installation movies for their paths, names, and hashsums.
	$LF
]div
[ul 
	[li 
		" 
		[b 
			"If some hashsum does not match, you'll have to redo the installation process again, because that's the only way to ensure your actual TAS will sync for other people!
		]b
		$LF
	]li
]ul
[h3 id=Encodes 
	" Encodes
	$LF
]h3
[div class= 
	[div class= 
		[ul class=nav nav-tabs role=tablist 
			[li class=nav-item 
				[a class=active nav-link data-bs-toggle=tab href=#tabs-4832-0 
					"Windows 95B OSR 2
				]a
			]li
			[li class=nav-item 
				[a class=nav-link data-bs-toggle=tab href=#tabs-4832-1 
					"Windows XP SP 3
				]a
			]li
			[li class=nav-item 
				[a class=nav-link data-bs-toggle=tab href=#tabs-4832-2 
					"Setting up Windows XP in libTAS
				]a
			]li
		]ul
	]div
	[div class=tab-content 
		[div class=tab-pane fade active show id=tabs-4832-0 
			[div class=p 
				(youtube|v=LnJyyFauV4I)
				$LF
			]div
		]div
		[div class=tab-pane fade id=tabs-4832-1 
			[div class=p 
				(youtube|v=lfc2k1hKow8)
				$LF
			]div
		]div
		[div class=tab-pane fade id=tabs-4832-2 
			[div class=p 
				(youtube|v=GJodywbJNcM)
				$LF
			]div
		]div
	]div
]div
[h2 id=UsingWindowsWithLibtas 
	" Using Windows with libTAS
	$LF
]h2
[h3 id=FlashBinAndNvr 
	" flash.bin and NVR
	$LF
]h3
[div class=p 
	[code 
		"flash.bin
	]code
	" is file a created by the system, it contains the flash memory of the system. Because the ROM gets written into it, we can't distribute it. This file may also contain custom system parameters from previous configs using the chipset.
	$LF
]div
[div class=p 
	"Similarly, a non-volatile memory file is created in 
	[code 
		"~/.pcem/nvr/
	]code
	" named after your machine config and motherboard (for example 
	[code 
		"windowsxp.ga686bx.nvr
	]code
	"). It is also required for movie sync. It 
	[em 
		"can
	]em
	" be distributed, but it's pointless to distribute it, since the installation movie has to be run anyway, and it recreates the NVR file.
	$LF
]div
[ul 
	[li 
		" 
		[b 
			"You must always start with the 
			[code 
				"~/.pcem/roms/ga686bx/flash.bin
			]code
			" and 
			[code 
				"~/.pcem/nvr/windowsxp.ga686bx.nvr
			]code
			" files that were generated from the Windows XP installation movie
		]b
		".
		$LF
		[ul 
			[li 
				" If you use a verification movie to install your game, you should start with 
				[code 
					"flash.bin
				]code
				" and 
				[code 
					".nvr
				]code
				" that were generated from that.
				$LF
			]li
		]ul
	]li
]ul
[h3 id=LibtasSettings 
	" libTAS Settings
	$LF
]h3
[ul 
	[li 
		" All settings from the 
		(__wikiLink|displaytext=main PCem guide|href=/EmulatorResources/PCem#UsingLibtasWithPcem)
		" apply
		$LF
	]li
	[li 
		" Games that attempt to fetch the current time and date may not work correctly using the default system time in libTAS (which results in 2070-01-01). To fix this, set the system time to a date between 2000-01-01 (946684800 
		[em 
			"System time
		]em
		" in libTAS) and 2037-12-31 (2145830400).
		$LF
		[ul 
			[li 
				" 1980-01-01 (2145830400 
				[em 
					"System time
				]em
				" in libTAS) to 1999-12-31 (946684800) should also work. However, Windows XP is known to take substantially longer to boot up using system times in this range (see Trivia below) and hence this is not recommended.
				$LF
			]li
		]ul
	]li
]ul
[h2 id=Trivia 
	" Trivia
	$LF
]h2
[div class= 
	[div class= 
		[ul class=nav nav-tabs role=tablist 
			[li class=nav-item 
				[a class=active nav-link data-bs-toggle=tab href=#tabs-6661-0 
					"Hide
				]a
			]li
			[li class=nav-item 
				[a class=nav-link data-bs-toggle=tab href=#tabs-6661-1 
					"Driver VSync setting
				]a
			]li
			[li class=nav-item 
				[a class=nav-link data-bs-toggle=tab href=#tabs-6661-2 
					"System time and startup timecodes
				]a
			]li
		]ul
	]div
	[div class=tab-content 
		[div class=tab-pane fade active show id=tabs-6661-0 
		]div
		[div class=tab-pane fade id=tabs-6661-1 
			[ul 
				[li 
					" Double-click on the 3dfx icon in the Notification area (alternatively, right-click it and select 
					[em 
						"3dfx Voodoo 3 Board - 3dfx Hub
					]em
					")
					$LF
				]li
				[li 
					" Go to 
					[em 
						"3dfx Advanced Features
					]em
					" tab
					$LF
				]li
				[li 
					" Go to 
					[em 
						"Direct3D
					]em
					" (or 
					[em 
						"OpenGL/Glide
					]em
					", depending on the game) -> 
					[em 
						"Speed Settings
					]em
					$LF
				]li
				[li 
					" Change 
					[em 
						"Fastest (V-Sync Disabled)
					]em
					" to 
					[em 
						"Normal (V-Sync Enabled)
					]em
					" by double-clicking on the current option and selecting the other one in the dropdown that appears
					$LF
				]li
			]ul
			[div class=p 
				"This may reduce screen tearing in your game, but it's not guaranteed to help.
				$LF
			]div
		]div
		[div class=tab-pane fade id=tabs-6661-2 
			[table 
				[tbody 
					[tr 
						[th 
							" Starting time 
						]th
						[th 
							"   3dfx card BIOS 
						]th
						[th 
							" Pentium II BIOS 
						]th
						[th 
							" System Config 
						]th
						[th 
							" Windows XP 
						]th
						[th 
							" Res increase 
						]th
						[th 
							" Mouse appears 
						]th
						[th 
							" Welcome 
						]th
						[th 
							" Desktop 
						]th
					]tr
					[tr 
						[td 
							"              1 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.39 
						]td
						[td 
							"          44.55 
						]td
						[td 
							"    48.75 
						]td
						[td 
							"    51.56 
						]td
					]tr
					[tr 
						[td 
							"      100000000 
						]td
						[td 
							" Trial expiry      
						]td
						[td 
							"                  
						]td
						[td 
							"                
						]td
						[td 
							"             
						]td
						[td 
							"               
						]td
						[td 
							"                
						]td
						[td 
							"          
						]td
						[td 
							"          
						]td
					]tr
					[tr 
						[td 
							"      300000000 
						]td
						[td 
							" Trial expiry      
						]td
						[td 
							"                  
						]td
						[td 
							"                
						]td
						[td 
							"             
						]td
						[td 
							"               
						]td
						[td 
							"                
						]td
						[td 
							"          
						]td
						[td 
							"          
						]td
					]tr
					[tr 
						[td 
							"      400000000 
						]td
						[td 
							" Invalid time/date 
						]td
						[td 
							"                  
						]td
						[td 
							"                
						]td
						[td 
							"             
						]td
						[td 
							"               
						]td
						[td 
							"                
						]td
						[td 
							"          
						]td
						[td 
							"          
						]td
					]tr
					[tr 
						[td 
							"      500000000 
						]td
						[td 
							" Too long (300+)   
						]td
						[td 
							"                  
						]td
						[td 
							"                
						]td
						[td 
							"             
						]td
						[td 
							"               
						]td
						[td 
							"                
						]td
						[td 
							"          
						]td
						[td 
							"          
						]td
					]tr
					[tr 
						[td 
							"      800000000 
						]td
						[td 
							" Invalid time/date 
						]td
						[td 
							"                  
						]td
						[td 
							"                
						]td
						[td 
							"             
						]td
						[td 
							"               
						]td
						[td 
							"                
						]td
						[td 
							"          
						]td
						[td 
							"          
						]td
					]tr
					[tr 
						[td 
							"     1000000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         53.42 
						]td
						[td 
							"          55.88 
						]td
						[td 
							"    60.63 
						]td
						[td 
							"    68.75 
						]td
					]tr
					[tr 
						[td 
							"     1100000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.4  
						]td
						[td 
							"          44.56 
						]td
						[td 
							"    48.94 
						]td
						[td 
							"    51.39 
						]td
					]tr
					[tr 
						[td 
							"     1200000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.42 
						]td
						[td 
							"          44.58 
						]td
						[td 
							"    48.84 
						]td
						[td 
							"    51.49 
						]td
					]tr
					[tr 
						[td 
							"     1300000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.4  
						]td
						[td 
							"          44.56 
						]td
						[td 
							"    48.55 
						]td
						[td 
							"    53.62 
						]td
					]tr
					[tr 
						[td 
							"     1400000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         53.42 
						]td
						[td 
							"          55.89 
						]td
						[td 
							"    58.36 
						]td
						[td 
							"    68.84 
						]td
					]tr
					[tr 
						[td 
							"     1500000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         53.42 
						]td
						[td 
							"          55.88 
						]td
						[td 
							"    58.31 
						]td
						[td 
							"    68.78 
						]td
					]tr
					[tr 
						[td 
							"     1600000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         53.42 
						]td
						[td 
							"          55.88 
						]td
						[td 
							"    59.92 
						]td
						[td 
							"    68.72 
						]td
					]tr
					[tr 
						[td 
							"     1700000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.4  
						]td
						[td 
							"          44.56 
						]td
						[td 
							"    48.74 
						]td
						[td 
							"    51.1  
						]td
					]tr
					[tr 
						[td 
							"     1800000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.4  
						]td
						[td 
							"          44.56 
						]td
						[td 
							"    48.91 
						]td
						[td 
							"    51.36 
						]td
					]tr
					[tr 
						[td 
							"     1900000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         44.4  
						]td
						[td 
							"          44.57 
						]td
						[td 
							"    49.01 
						]td
						[td 
							"    51.36 
						]td
					]tr
					[tr 
						[td 
							"     2000000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         53.42 
						]td
						[td 
							"          55.88 
						]td
						[td 
							"    59.88 
						]td
						[td 
							"    68.75 
						]td
					]tr
					[tr 
						[td 
							"     2100000000 
						]td
						[td 
							"              2.27 
						]td
						[td 
							"             3.63 
						]td
						[td 
							"           9.57 
						]td
						[td 
							"       13.82 
						]td
						[td 
							"         53.42 
						]td
						[td 
							"          55.89 
						]td
						[td 
							"    58.27 
						]td
						[td 
							"    68.76 
						]td
					]tr
				]tbody
			]table
			[div class=p 
				"Legend:
				$LF
			]div
			[ul 
				[li 
					" 
					[b 
						"3dfx card BIOS
					]b
					" = first frame that the text is visible onscreen
					$LF
				]li
				[li 
					" 
					[b 
						"Pentium II BIOS
					]b
					" = first frame that the text is visible onscreen
					$LF
				]li
				[li 
					" 
					[b 
						"System Config
					]b
					" = frame that the window settles on its new resolution
					$LF
				]li
				[li 
					" 
					[b 
						"Windows XP
					]b
					" = frame that the window settles on its new resolution of 640x480
					$LF
				]li
				[li 
					" 
					[b 
						"Res increase
					]b
					" = frame that the window settles on its new resolution of 800x600
					$LF
				]li
				[li 
					" 
					[b 
						"Mouse appears
					]b
					" = first frame that the mouse appears onscreen
					$LF
				]li
				[li 
					" 
					[b 
						"Welcome
					]b
					" = first frame that the welcome screen (or "Windows is starting up") is fully visible
					$LF
				]li
				[li 
					" 
					[b 
						"Desktop
					]b
					" = first frame that the desktop is fully visible
					$LF
				]li
			]ul
		]div
	]div
]div
[div class=p 
	[br 
	]br
]div
