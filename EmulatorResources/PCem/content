105
[div class=p 
	[a href=https://github.com/TASEmulators/pcem rel=noopener external nofollow 
		"PCem
	]a
	" doesn't have TAS tools, but it works well in 
	(__wikiLink|displaytext=libTAS|href=/EmulatorResources/LibTAS)
	", so it's otherwise quite TASable at this point. In addition to running DOS, it can run Linux and early Windows, along with various environments like Flash or Java.
	$LF
]div
[ul 
	[li 
		" Ensure you have completed the libTAS and PCem prerequisites in the 
		(__wikiLink|displaytext=What you'll need|href=/EmulatorResources/PCem#WhatYouLlNeed)
		" section and consider skimming the usage information below before continuing on to another guide.
		$LF
	]li
	[li 
		" General PCem usage can be found in 
		(__wikiLink|displaytext=this guide|href=/EmulatorResources/PCem/General)
		" but follow the steps below for specific DOS and Windows configurations.
		$LF
	]li
	[li 
		" If you want to use PCem for 
		[b 
			"DOS
		]b
		" TASing, we have pre-made configurations available. Look 
		(__wikiLink|displaytext=here|href=/EmulatorResources/PCem/DOS)
		" for information on setting up for DOS.
		$LF
	]li
	[li 
		" If you want to use PCem for 
		[b 
			"Windows 95/XP
		]b
		" TASing, you can 
		(__wikiLink|displaytext=run our Windows installation movie|href=/EmulatorResources/PCem/Windows#WhatYouLlNeed)
		".
		$LF
	]li
	[li 
		" Please read our 
		(__wikiLink|displaytext=submission rules|href=/EmulatorResources/PCem#MovieSubmissions)
		" regarding PCem in libTAS.
		$LF
	]li
]ul
[div class=card mb-2 
	[div class=card-header 
		[strong 
			"Table of contents
		]strong
	]div
	[div class=card-body 
		[ul 
			[li 
				[a href=#WhatYouLlNeed 
					" What you'll need
					$LF
				]a
			]li
			[li 
				[a href=#UsingLibtasWithPcem 
					" Using libTAS with PCem
					$LF
				]a
				[ul 
					[li 
						[a href=#VeryImportantSyncNotes 
							" Very important sync notes
							$LF
						]a
					]li
					[li 
						[a href=#Settings 
							" Settings
							$LF
						]a
					]li
					[li 
						[a href=#Tips 
							" Tips
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#InstallingYourGame 
					" Installing your game
					$LF
				]a
				[ul 
					[li 
						[a href=#InstallingFromOriginalMedia 
							" Installing from original media
							$LF
						]a
					]li
					[li 
						[a href=#UsingPreInstalledVersion 
							" Using pre-installed version
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#SwappingDisks 
					" Swapping disks
					$LF
				]a
			]li
			[li 
				[a href=#MovieSubmissions 
					" Movie submissions
					$LF
				]a
				[ul 
					[li 
						[a href=#EmulateCompatibleMachine 
							" Emulate compatible machine
							$LF
						]a
					]li
					[li 
						[a href=#GameInstallation 
							" Game installation
							$LF
						]a
					]li
				]ul
			]li
		]ul
	]div
]div
[h2 id=WhatYouLlNeed 
	" What you'll need
	$LF
]h2
[ul 
	[li 
		" 
		[a href=https://github.com/clementgallet/libTAS/releases rel=noopener external nofollow 
			"libTAS
		]a
		" 1.4.2 or newer.
		$LF
	]li
	[li 
		" 
		[a href=https://github.com/TASEmulators/pcem/releases/tag/17%2Bst-1 rel=noopener external nofollow 
			"PCem 17+st-1
		]a
		" or newer. This fork has some modifications to make parts of PCem single-threaded. The normal build of PCem will have determinism issues.
		$LF
		[ul 
			[li 
				" Remember that the run must sync on an 
				(__wikiLink|displaytext=official emulator version|href=/MovieRules#BeforeStarting)
				" or it will not be accepted.
				$LF
			]li
			[li 
				" After starting PCem once, you will need to edit 
				[code 
					"~/.pcem/pcem.cfg
				]code
				" and set 
				[code 
					"confirm_on_stop_emulation = 0
				]code
				".
				$LF
			]li
		]ul
	]li
	[li 
		" ROMs for PCem v17. See the specific 
		(__wikiLink|displaytext=DOS|href=/EmulatorResources/PCem/DOS)
		" or 
		(__wikiLink|displaytext=Windows|href=/EmulatorResources/PCem/Windows)
		" configurations for a list of files you will need for the different chipsets that PCem supports. We can't provide the PCem ROMs, because they are copyrighted material. You can find ROM names for each piece of hardware in the 
		[a href=https://github.com/TASEmulators/pcem/tree/v17_13f53a2#systems rel=noopener external nofollow 
			"PCem readme
		]a
		". Put the ROMs in 
		[code 
			"~/.pcem/roms/
		]code
		" (this path can be changed by editing 
		[code 
			"~/.pcem/pcem.cfg
		]code
		").
		$LF
		[ul 
			[li 
				" Note that the Linux port of PCem is case sensitive, pay attention to the exact ROM filenames in the readme.
				$LF
			]li
		]ul
	]li
	[li 
		" A bootable floppy disk image or bootable CD. If you're setting up for DOS, you can use this modified boot floppy from JPC-rr, it has CD support added and is fully redistributable. 
		[a href=https://files.tasvideos.org/common/Wiki/pcem/floppy.7z rel=noopener external nofollow 
			"Get the disk here
		]a
		".
		$LF
	]li
	[li 
		" Have a game in mind when you start this guide. You can either pre-install the game in a folder and/or have the installation media for a game and/or OS (floppy images or ISOs are fine). See  
		(__wikiLink|displaytext=Installing Your Game|href=/EmulatorResources/PCem#InstallingYourGame)
		" for more information.
		$LF
	]li
]ul
[h2 id=UsingLibtasWithPcem 
	" Using libTAS with PCem
	$LF
]h2
[h3 id=VeryImportantSyncNotes 
	" Very important sync notes
	$LF
]h3
[div class=p 
	"Closely follow the guides in this section to prevent desyncs!
	$LF
]div
[ul 
	[li 
		" 
		[b 
			"Synchronization of your movie depends on the following file types:
		]b
		" 
		[code 
			".img
		]code
		", 
		[code 
			".nvr
		]code
		", 
		[code 
			".cfg
		]code
		", and 
		[code 
			"flash.bin
		]code
		".
		$LF
		[ul 
			[li 
				" If 
				[em 
					"Runtime -> Prevent writing to disk
				]em
				" is unchecked in libTAS, PCem will change your files, which will cause desyncs.
				$LF
			]li
			[li 
				" If you change those files yourself outside of libTAS+PCem movie, it will also cause desyncs.
				$LF
			]li
		]ul
	]li
	[li 
		" 
		[b 
			"All modifications to the hard drive need to be done within a libTAS+PCem movie!!!
		]b
		$LF
		[ul 
			[li 
				" Do not modify the hard drive image outside of PCem! Different methods of mounting the image and copying files onto it can result in different file structures which can result in desyncs.
				$LF
			]li
			[li 
				" Do not make unnecessary writes to the hard drive image! Seemingly harmless operations like making an empty folder and deleting it will cause desyncs. 
				$LF
			]li
		]ul
	]li
	[li 
		" 
		[b 
			"Always start with all sync related files from one of our official packages.
		]b
		$LF
		[ul 
			[li 
				" Back up your sync related files after you've installed your OS so you don't have to run the installation movie every time.
				$LF
			]li
		]ul
	]li
	[li 
		" 
		[b 
			"Use full paths everywhere.
		]b
		$LF
		[ul 
			[li 
				" Since paths will be different for different users, we use a placeholder 
				[code 
					"/full/path/to/file.ext
				]code
				" path in our guides. It is always meant to be substituted with whatever your actual full path to a given file is.
				$LF
			]li
		]ul
	]li
]ul
[h3 id=Settings 
	" Settings
	$LF
]h3
[div class=p 
	"libTAS needs some very specific settings to work with PCem, so read this section carefully.
	$LF
]div
[ol 
	[li 
		" Set the game executable to the full path to pcem, usually 
		[code 
			"/usr/bin/pcem
		]code
		".
		$LF
	]li
	[li 
		" Set the command line option to 
		[code 
			"--config /full/path/to/config.cfg
		]code
		", substituting the path of your 
		[code 
			".cfg
		]code
		" file appropriately. Use the full path, do not shorten it with 
		[code 
			"~
		]code
		".
		$LF
	]li
	[li 
		" Set the frames per second to 100/1 (PCem only runs at 100fps).
		$LF
	]li
	[li 
		" Make sure 
		[em 
			"Runtime -> Savestates -> Incremental savestates
		]em
		" is 
		[b 
			"unchecked
		]b
		" or savestates may not work.
		$LF
	]li
	[li 
		" Make sure 
		[em 
			"Runtime -> Prevent writing to disk
		]em
		" is 
		[b 
			"checked
		]b
		".
		$LF
		[ul 
			[li 
				" If your movie is going to contain a machine reboot using libTAS's 
				[em 
					"Restart
				]em
				" input, contents of PCem files in memory will still be written to those files on disk, even if you have 
				[em 
					"Prevent writing to disk
				]em
				" enabled.
				$LF
			]li
		]ul
	]li
]ol
[h3 id=Tips 
	" Tips
	$LF
]h3
[ul 
	[li 
		" Make a quick test encode to make sure your sound is working. libTAS will make many video segments so make sure you open and listen to the correct one.
		$LF
	]li
	[li 
		" Avoid loading a savestate made before a resolution change; this can cause desyncs, crashes, or just mess up the display.
		$LF
	]li
	[li 
		" CD reading can break or desync if you load a savestate made before PCem has started reading from the CD.
		$LF
	]li
	[li 
		" If you're using the mouse, don't make a right-click your first mouse input. This will make the right-click menu pop up, which will cause the display window to softlock. It's easy to avoid this by making an arbitrary left-click during boot, this will make PCem think the mouse is trapped and now you can right-click all you want.
		$LF
		[ul 
			[li 
				" Even if the emulated machine doesn't support the middle mouse button, hitting it will make PCem release the mouse, so the right-click menu becomes a risk again.
				$LF
			]li
		]ul
	]li
	[li 
		" Always use software rendering. Using hardware rendering seems to be unstable, at a random point in time the emulator will crash with 
		[code 
			"XXX: resource creation failed
		]code
		" spammed in the terminal.
		$LF
	]li
	[li 
		" If you use PCem GUI for managing configurations, be aware that it only handles 
		[code 
			".cfg
		]code
		" files and not 
		[a class=intlink href=#VeryImportantSyncNotes 
			"other files that determine sync
		]a
		". You'll need to manage the latter yourself.
		$LF
	]li
]ul
[h2 id=InstallingYourGame 
	" Installing your game
	$LF
]h2
[div class=p 
	"Ensure you have a working installation of your operating system using the links to the OS specific guides above.
	$LF
]div
[div class=p 
	"You may install your game either from original install disks or a folder containing the pre-installed game.
	$LF
]div
[div class=p 
	"In the .cfg file for your setup, set 
	[code 
		"cdrom_drive = 200
	]code
	" and 
	[code 
		"cdrom_path = /full/path/to/name.iso
	]code
	".
	$LF
]div
[ul 
	[li 
		" PCem handles paths with spaces fine, but they should not be put inside quotes.
		$LF
	]li
]ul
[h3 id=InstallingFromOriginalMedia 
	" Installing from original media
	$LF
]h3
[div class=p 
	"If you need to use multiple disks, see 
	(__wikiLink|displaytext=this section|href=/EmulatorResources/PCem#SwappingDisks)
	" for how to change disks within a movie.
	$LF
]div
[div class=p 
	"Try to use original unaltered versions of your disk images if possible. You can verify the authenticity of floppy images by checking the hashes on 
	[a href=https://www.goodolddays.net/diskimages/ rel=noopener external nofollow 
		"Good Old Days
	]a
	" (incomplete, but has quite a lot) or if you're using CDs you can reference 
	[a href=http://redump.org/discs/system/pc/ rel=noopener external nofollow 
		"redump
	]a
	".
	$LF
]div
[h3 id=UsingPreInstalledVersion 
	" Using pre-installed version
	$LF
]h3
[div class=p 
	"Put all the files into one folder. Files not necessary to run the game, such as readmes and order forms, can be omitted if desired.
	$LF
]div
[ul 
	[li 
		" 
		[b 
			"Do not include custom files that we will not be able to reproduce, such as personal save files and high score tables.
		]b
		$LF
	]li
]ul
[div class=p 
	"Make an ISO of the game files by executing 
	(__wikiLink|displaytext=this bash script|href=/UserFiles/Info/638314431260324188)
	" in a Linux terminal.
	$LF
]div
[div class=p 
	"When the operating system boots, you should copy the game files to the 
	[code 
		"C:
	]code
	" drive.
	$LF
]div
[ul 
	[li 
		" In DOS, use this command in the DOS prompt: 
		[code 
			"copy d:\*.* c:
		]code
		" or 
		[code 
			"xcopy d:\ c:\ /e
		]code
		" if there are subdirectories (you can buffer these inputs while FreeDOS is loading).
		$LF
	]li
	[li 
		" On Windows, just use the file explorer to copy the files to Desktop.
		$LF
	]li
]ul
[div class=p 
	"If the game comes with a setup utility, you may need to run it to set up proper graphics.
	$LF
]div
[h2 id=SwappingDisks 
	" Swapping disks
	$LF
]h2
[div class=p 
	"The right-click menu in normal PCem bugs out in libTAS, presenting a problem when swapping disks is needed mid-TAS. Keylie has kindly coded in hotkeys to the TASVideos build of PCem to solve this. 
	$LF
]div
[div class=p 
	"To specify the list of disks you want to use, you need to manually put them into the .cfg file where the disk path would normally be. The list should be the paths of the disks delimited by semicolons.
	$LF
]div
[div class=p 
	"For CDs, for example, you should specify 
	[code 
		"cdrom_path = path1;path2;path3;etc...
	]code
	" Also set 
	[code 
		"cdrom_drive = 200
	]code
	", otherwise this will not work.
	$LF
]div
[div class=p 
	"For floppy drives A: and B: respectively, specify 
	[code 
		"disc_a = path1;path2;path3;etc...
	]code
	" and 
	[code 
		"disc_b = path1;path2;path3;etc...
	]code
	$LF
]div
[div class=p 
	"The following hotkeys control disk swapping.
	$LF
]div
[ul 
	[li 
		" CD: 
		[code 
			"Ctrl
		]code
		" + 
		[code 
			",
		]code
		" + 
		[code 
			"Arrow
		]code
		$LF
	]li
	[li 
		" Floppy drive A: 
		[code 
			"Ctrl
		]code
		" + 
		[code 
			".
		]code
		" + 
		[code 
			"Arrow
		]code
		$LF
	]li
	[li 
		" Floppy drive B: 
		[code 
			"Ctrl
		]code
		" + 
		[code 
			"/
		]code
		" + 
		[code 
			"Arrow
		]code
		$LF
	]li
]ul
[div class=p 
	"Where 
	[code 
		"Arrow
	]code
	" is:
	$LF
]div
[ul 
	[li 
		" 
		[code 
			"Left
		]code
		": Select previous disk in list
		$LF
	]li
	[li 
		" 
		[code 
			"Right
		]code
		": Select next disk in list
		$LF
	]li
	[li 
		" 
		[code 
			"Down
		]code
		": Load selected disk
		$LF
		[ul 
			[li 
				" Loading is 
				[b 
					"required
				]b
				" after you've selected the disk you need.
				$LF
			]li
		]ul
	]li
	[li 
		" 
		[code 
			"Up
		]code
		": Eject current disk
		$LF
	]li
]ul
[div class=p 
	"The messages for disk selections and loading will be displayed in the console window.
	$LF
]div
[h2 id=MovieSubmissions 
	" Movie submissions
	$LF
]h2
[div class=p 
	"We 
	(__wikiLink|displaytext=allow libTAS to run PCem|href=/EmulatorResources/LibTAS#MovieSubmissions)
	" as an IBM-PC emulator for 
	(__wikiLink|displaytext=DOS|href=/EmulatorResources/PCem/DOS#UsingWithLibtas)
	" and 
	(__wikiLink|displaytext=Windows|href=/EmulatorResources/PCem/Windows#UsingWithLibtas)
	". Only 
	[a href=https://github.com/TASEmulators/pcem/releases rel=noopener external nofollow 
		"TASVideos releases
	]a
	" of PCem are allowed (17+st-2 is a pre-release, and not currently allowed). Such releases are marked 
	[code 
		"st
	]code
	" to indicate single-threading - modification required for determinism, not available in the original PCem.
	$LF
]div
[div class=p 
	"Put 
	[code 
		"Platform: DOS
	]code
	" or 
	[code 
		"Platform: Windows
	]code
	" (depending on which one you're running) at the very start of the .ltm movie annotations, that way the site will recognize your platform properly.
	$LF
]div
[div class=p 
	"Use .ltm annotations or submission notes to document:
	$LF
]div
[ul 
	[li 
		" Which machine ROM files your movie 
		[em 
			"requires
		]em
		", along with their hashsums (PCem logs to the terminal which ROMs it's loading).
		$LF
	]li
	[li 
		" Hashsums for your installation media, or for all the individual game files if you're using 
		(__wikiLink|displaytext=the pre-installed game method|href=/EmulatorResources/PCem#UsingPreInstalledVersion)
		$LF
	]li
	[li 
		" Scripts that can hash entire folders on Linux and Windows are provided 
		(__wikiLink|displaytext=in this thread|href=/Forum/Topics/22813)
		".
		$LF
	]li
]ul
[h3 id=EmulateCompatibleMachine 
	" Emulate compatible machine
	$LF
]h3
[div class=p 
	"PCem can emulate variety of machines, but we only accept systems representing an era of IBM-PC games based on release date and system requirements. We accept 
	(__wikiLink|displaytext=4 machine configurations for DOS|href=/EmulatorResources/PCem/DOS#PremadeConfigurations)
	", and 
	(__wikiLink|displaytext=2 for Windows|href=/EmulatorResources/PCem/Windows#WhatYouLlNeed)
	".
	$LF
]div
[div class=p 
	"If the game you're TASing doesn't work properly on either of these setups (or you want to add more RAM, or a joystick, or do another useful tweak), you can modify the 
	[code 
		".cfg
	]code
	" setup that's closest to your desired specs, to make your game work well. Keep in mind though that 
	(__wikiLink|displaytext=PC game environment must be legitimate|href=/MovieRules#GameplayMustBeAccurateToHardware)
	".
	$LF
]div
[div class=p 
	"If your modifications are beyond tweaking the 
	[code 
		".cfg
	]code
	" files, you will need to record a libTAS movie of you setting up your config, similar to how 
	(__wikiLink|displaytext=our setups|href=/EmulatorResources/PCem/DOS/Configurations)
	" 
	(__wikiLink|displaytext=were recorded|href=/EmulatorResources/PCem/Windows/Configurations)
	", including meticulous documentation of the process. Explain what and why you're changing too.
	$LF
]div
[h3 id=GameInstallation 
	" Game installation
	$LF
]h3
[div class=p 
	(__wikiLink|displaytext=Game installation|href=/EmulatorResources/PCem#InstallingYourGame)
	" can be a part of your main movie, unless you're installing from a CD image or the installation process takes several minutes.
	$LF
]div
[div class=p 
	"If game installation is a part of your main movie, it shouldn't waste time for no reason, but still configure your game to look and sound best. If game installation is done in a separate file, optimizing it is not required, just make sure to provide it as a verification movie.
	$LF
]div
[ul 
	[li 
		" When making a verification movie, it's recommended you first record it with 
		[em 
			"Runtime -> Prevent writing to disk
		]em
		" checked, and then play it back with this setting unchecked to create the modified files you'll be using.
		$LF
	]li
	[li 
		" 
		[b 
			"Do not enter a CD key or serial in any of your movies!
		]b
		" It is illegal to distribute these. Game activation needs to be done outside the libTAS movie! The game must be installed, activated, and only then 
		(__wikiLink|displaytext=put onto an ISO with all the required files|href=/EmulatorResources/PCem#UsingPreInstalledVersion)
		".
	]li
]ul
