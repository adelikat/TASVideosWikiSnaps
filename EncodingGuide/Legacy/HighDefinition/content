86
[div class=p 
	"This page outlines the essentials of creating high definition encodes for upload to 
	(__wikiLink|displaytext=streaming media|href=/EncodingGuide/Legacy/StreamingMedia)
	" sites.
	$LF
]div
[div class=card mb-2 
	[div class=card-header 
		[strong 
			"Table of contents
		]strong
	]div
	[div class=card-body 
		[ul 
			[li 
				[a href=#BasicConcepts 
					"Basic concepts
					$LF
				]a
				[ul 
					[li 
						[a href=#Rationale 
							"Rationale
							$LF
						]a
					]li
					[li 
						[a href=#Steps 
							"Steps
							$LF
						]a
					]li
					[li 
						[a href=#NoteAbout3dGames 
							"Note about 3D games
							$LF
						]a
					]li
				]ul
			]li
			[li 
				[a href=#ExampleScript 
					"Example script
					$LF
				]a
			]li
			[li 
				[a href=#CommandLines 
					"Command lines
					$LF
				]a
			]li
		]ul
	]div
]div
[h2 id=BasicConcepts 
	"Basic concepts
	$LF
]h2
[div class=p 
	[em 
		(__wikiLink|href=/TODO|implicitdisplaytext=TODO)
		": Speak about 8x8 resizing.
	]em
	$LF
]div
[h3 id=Rationale 
	"Rationale
	$LF
]h3
[div class=p 
	"The h.264 video format uses the YV12 colorspace; conversion to this colorspace on a pixel-to-pixel basis is invariably lossy due to chroma subsampling (i.e. the image dimensions of the colour information in the image is half that of the full image resolution).  To avoid loss of data to this chroma subsampling, one can ensure that each 2x2 block in image has the same colours as this would mean that the entire 2x2 block is one colour and can therefore be scaled down without loss. Thus, the scaling ratio has to be an even integer
	[a id=r1 
	]a
	[sup 
		"[
		[a href=#1 
			"1
		]a
		"]
	]sup
	" and the scaling algorithm has to be nearest neighbour
	[a id=r2 
	]a
	[sup 
		"[
		[a href=#2 
			"2
		]a
		"]
	]sup
	" in order to guarantee that each resulting 2x2 block is one colour.
	$LF
]div
[div class=p 
	"YouTube's maximum high definition size is 1920x1080, though recently support has been added for resolutions greater than this which shows up as "Original".  If YouTube is sent an encode with a vertical resolution greater than 1080, it will generate a 1080p encode without image borders.
	$LF
]div
[div class=p 
	"YouTube also only supports frame rates of up to 30 FPS, though it will automatically
	$LF
	"downconvert videos uploaded at a higher frame rate.  Several alternatives exist for addressing this, such as simple decimation, interframe blending (partial or 
	(__wikiLink|displaytext=total|href=/EncodingGuide/Legacy/TASBlend)
	"); the most competent at present is "
	[a class=intlink href=/Users/Profile/nanogyth 
		"ng_deblink
	]a
	"".
	$LF
]div
[h3 id=Steps 
	"Steps
	$LF
]h3
[ol 
	[li 
		" Dump the movie using an RGB32 lossless
		[a id=r3 
		]a
		[sup 
			"[
			[a href=#3 
				"3
			]a
			"]
		]sup
		" codec. Lagarith and Camstudio Codec are popular choices.
		$LF
	]li
	[li 
		" Convert the image to correct colorspace using point scaling (as opposed to the normally-used Lanczos scaling); this ensures that there is no "bleeding" between chroma samples.
		$LF
	]li
	[li 
		" Set your logo's resolution to prevent its resizing by x264.
		$LF
	]li
	[li 
		" Encode the video using x264 (fairly high quality settings are desirable as YouTube will end up re-encoding the video anyway). Resize it by factor of 8, this would reduce the file size when compressing by x264, and activate YouTube's "original mode" processing (above 1080p).
		$LF
	]li
	[li 
		" Use OGG or WAV as your audio track.
		$LF
	]li
	[li 
		" Correct the aspect ration on YouTube.
		$LF
	]li
]ol
[h3 id=NoteAbout3dGames 
	"Note about 3D games
	$LF
]h3
[div class=p 
	"Games that make use of 3D (i.e. those on 3D consoles such as the N64, PSX, Saturn, or DS) are not HD encoded in this fashion; they are instead dumped at higher resolution and then encoded. 
	$LF
]div
[h2 id=ExampleScript 
	"Example script
	$LF
]h2
[div class=p 
	"To get the script working you need these plugins for AVISynth:
	$LF
]div
[ul 
	[li 
		" 
		[a href=http://manao4.free.fr/mvtools.htm rel=noopener external nofollow 
			"mvtools2.dll
		]a
		$LF
	]li
	[li 
		" 
		[a href=http://manao4.free.fr/mt_masktools.html rel=noopener external nofollow 
			"mt_masktools-26.dll
		]a
		$LF
	]li
]ul
[div class=p 
	"Both can be obtained by 
	[a href=https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/feos-tas/AVISynth%20plugins%20for%20ng_deblink.7z rel=noopener external nofollow 
		"this link
	]a
	".
	$LF
]div
[pre 
	[code class=language-avs 
		$UNPRINTABLE TEXT!!!
	]code
]pre
[div class=p 
	[b 
		"Note
	]b
	": To import an animated logo instead of a static logo, you should replace this line...
	$LF
]div
[pre 
	[code class=language-shell 
		$UNPRINTABLE TEXT!!!
	]code
]pre
[div class=p 
	"by this line.
	$LF
]div
[pre 
	[code class=language-shell 
		$UNPRINTABLE TEXT!!!
	]code
]pre
[div class=p 
	"If your logo was made for 60 FPS movies, you should use this line below.
	$LF
]div
[pre 
	[code class=language-shell 
		$UNPRINTABLE TEXT!!!
	]code
]pre
[h2 id=CommandLines 
	"Command lines
	$LF
]h2
[div class=p 
	"The following command is used for x264 encoding and implies you named your script 
	[code 
		"hd.avs
	]code
	":
	$LF
]div
[pre 
	"x264 --qp 0 --keyint 600 --range tv --colorprim bt709 --transfer bt709 --colormatrix bt709 --output  video.mp4 hd.avs
	$LF
]pre
[div class=p 
	"YouTube doesn't seem to support FLAC anymore, so either use Raw PCM (.WAV) directly, or high bitrate Vorbis (.OGG).
	$LF
]div
[pre 
	"oggenc2 -q 10 audio.wav
	$LF
]pre
[div class=p 
	"Muxing is also quite simple:
	$LF
]div
[pre 
	"mkvmerge --engage no_simpleblocks --compression -1:none video.mp4 audio.ogg -o TAS.mkv
	$LF
]pre
[div class=p 
	"After uploading to YouTube, add that tag to resulting video to correct the aspect ratio for TV consoles (not for handhelds):
	$LF
]div
[pre 
	"yt:resize=4:3
	$LF
]pre
[hr 
]hr
[div class=p 
	"[
	[a id=1 
	]a
	[a href=#r1 
		"1
	]a
	"]
	" Many DOS games, and output from many games played in openMSX when using the 
	[code 
		"-doublesize
	]code
	" option, have double-scanned output, i.e. the pixels are already in 2x2 blocks; the 'even' requirement is not needed in that case.
	$LF
]div
[div class=p 
	"[
	[a id=2 
	]a
	[a href=#r2 
		"2
	]a
	"]
	" Use of a weighted average algorithm is also acceptable, as it results in the exact same image as nearest neighbour if scaling up by integer.
	$LF
]div
[div class=p 
	"[
	[a id=3 
	]a
	[a href=#r3 
		"3
	]a
	"]
	" This does NOT include x264 lossless, which performs an RGB32-to-YV12 colorspace conversion (unless specifically set to i444 or RGB mode); this is both irreversible and lossy.
	$LF
]div
[div class=p 
	"[
	[a id=4 
	]a
	[a href=#r4 
		"4
	]a
	"]
	" For games meeting the criteria set out in footnote 1, the doubling can be omitted as the source material is already scaled by 2x.
	$LF
]div
[div class=p 
	"[
	[a id=5 
	]a
	[a href=#r5 
		"5
	]a
	"]
	" For some consoles (Sega Genesis in particular), this can yield resolutions above and beyond what YouTube can accept. One possible alternative to the formula presented here is to calculate the even integer mentioned for handhelds, scale by half that amount, scale the result to a 4:3 aspect ratio, and scale once more by a factor of two; this yields 2x2 blocks, but not all pixels will be the same size.
	$LF
]div
